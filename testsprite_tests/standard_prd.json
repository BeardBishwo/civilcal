{
  "meta": {
    "project": "EngiCal Pro",
    "date": "2025-11-14",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "EngiCal Pro is a premium, modular, and enterprise-grade web-based engineering calculator platform designed specifically for Architecture, Engineering, and Construction (AEC) professionals. It offers over 250 specialized calculators across 10 major engineering disciplines with robust features including multi-tenant architecture, role-based access control, API integrations, comprehensive export options, and advanced security measures.",
  "core_goals": [
    "Deliver a comprehensive suite of over 250 specialized engineering calculators across 10 AEC disciplines.",
    "Provide a secure, scalable, and modular SaaS architecture suitable for enterprises and individual professionals.",
    "Enable professional-grade user management with robust authentication, authorization, and profile capabilities.",
    "Support multi-tenant architecture with resource isolation and tenant-specific branding.",
    "Facilitate seamless payment processing, subscription management, and billing integration.",
    "Offer detailed calculation history management, export capabilities, and team collaboration tools.",
    "Implement a full REST API enabling third-party integration and developer-friendly extension.",
    "Maintain high security standards including bcrypt password hashing, CSRF protection, audit logging, and GDPR compliance.",
    "Ensure responsive, accessible, and performant user interfaces including PWA support and dark mode.",
    "Provide an extensible theme and plugin system for customization and expansion.",
    "Deliver advanced performance monitoring, caching, and query optimization for high-traffic environments."
  ],
  "key_features": [
    "Extensive Engineering Calculator Suite: Over 250 calculators across Civil, Electrical, HVAC, Plumbing, Fire Protection, Structural Engineering, and more.",
    "Authentication & Authorization: Email/password login, social login (Twitter OAuth), two-factor authentication, session management, RBAC, and admin panel access controls.",
    "Multi-Tenant Architecture: Tenant isolation at database and application levels with customizable resource quotas and branding.",
    "Payment & Subscriptions: Integrations with PayPal, Stripe, Mollie, recurring billing, subscription plans, and refund management.",
    "Calculation History & Management: Unlimited saves, project organization, search/filter, exports in PDF/Excel/CSV, and sharing capabilities.",
    "Export & Reporting: Professional reports with customizable templates supporting multiple formats including print-optimized layouts.",
    "Comprehensive REST API: Token-based auth, rate limiting, webhook support, interactive API explorer, and developer portal.",
    "Theme & Plugin System: Multi-theme architecture with white-label capabilities, CSS variables, plugin marketplace, and runtime toggles.",
    "Image Management: Secure upload and storage of logos, favicons, banners, and profile photos with automatic optimization.",
    "Security Features: Strong password policies, CSRF protection, session security, SQL injection prevention, XSS protection, rate limiting, and GDPR compliance.",
    "Performance Optimization: Real-time system monitoring, query optimizer, multi-tier caching with Redis/Memcached, and performance dashboard."
  ],
  "user_flow_summary": [
    "Guest User Browsing: Access public calculators, view pricing and plans, and try limited calculators without registration.",
    "User Registration & Authentication: Register with username/email/password, login with session or remember-me tokens, enable 2FA, and manage profiles including avatar uploads.",
    "Calculator Usage: Select calculator modules by engineering discipline, input parameters, perform calculations with validation, and view/share results.",
    "Calculation History Management: Save calculations, organize by projects, search, filter, export results, and share with team members or publicly.",
    "Subscription Management: Choose plans, enter payment details, handle recurring billing, and manage subscription status and invoices.",
    "Admin Access & Management: Admin users login to admin panel, manage users, configure settings, activate themes/plugins, and monitor performance via dashboards.",
    "API Usage: Developers obtain API keys, authenticate via tokens, perform calculations programmatically, access histories, and manage integrations.",
    "Theme & Branding Customization: Admins manage themes, upload branding images, and customize UI elements dynamically.",
    "Performance Monitoring: Access real-time dashboards showing system health, bottlenecks, cache stats, slow queries, and receive optimization recommendations."
  ],
  "validation_criteria": [
    "All calculator modules perform accurate computations and validate user inputs correctly.",
    "Authentication system securely handles login, logout, password reset, and session management with proper token generation and expiry.",
    "CSRF protection tokens are correctly generated, rotated, validated, and enforced on all state-changing requests.",
    "Admin panel features are fully functional with access restricted to authorized admin roles and UI loading correctly without dependency errors.",
    "Database connectivity is stable with connection pooling and correctness verified via integration tests.",
    "Performance optimizations provide measurable improvements in query speed, cache hit rates, and response times under load.",
    "APIs respond according to OpenAPI specifications with appropriate error handling and authentication enforcement.",
    "Image uploads support required formats, size limits, and optimize files automatically with fallback capabilities.",
    "Theme and plugin management UI properly lists, activates, and configures extensions with secure interactions.",
    "Security safeguards including rate limiting, input sanitization, and audit logging function correctly with no data leaks.",
    "System passes all TestSprite automated tests with 100% pass rate indicating production readiness.",
    "UI is responsive, accessible, and functions correctly across supported browsers and devices."
  ],
  "code_summary": {
    "tech_stack": [
      "PHP 8.x",
      "Custom MVC framework (FastRoute router)",
      "Composer autoloading",
      "MySQL / MariaDB",
      "Twig-inspired view layer",
      "Vanilla JS + Fetch API",
      "Session & cookie authentication",
      "REST-style JSON endpoints"
    ],
    "features": [
      {
        "name": "Authentication API",
        "description": "Endpoints that perform login/logout, username checks, remember-me session creation, and password reset flows.",
        "files": [
          "app/Controllers/Api/AuthController.php",
          "app/Core/Auth.php",
          "app/Models/User.php",
          "app/Middleware/AuthMiddleware.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Authentication API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/login": {
              "post": {
                "summary": "Authenticate using username or email plus password.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "username_email": {
                            "type": "string"
                          },
                          "password": {
                            "type": "string"
                          },
                          "remember_me": {
                            "type": "boolean"
                          }
                        },
                        "required": [
                          "username_email",
                          "password"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Login success payload with session + auth token."
                  },
                  "400": {
                    "description": "Missing credentials."
                  },
                  "401": {
                    "description": "Invalid username or password."
                  }
                }
              }
            },
            "/api/logout": {
              "get": {
                "summary": "Destroy active session and auth token.",
                "responses": {
                  "200": {
                    "description": "Logout confirmed."
                  },
                  "401": {
                    "description": "User is not authenticated."
                  }
                }
              }
            },
            "/api/check-username": {
              "post": {
                "summary": "Check username availability for registration UI.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "username": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "username"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Availability + suggestion payload."
                  },
                  "400": {
                    "description": "Invalid input."
                  }
                }
              }
            },
            "/api/forgot-password": {
              "post": {
                "summary": "Trigger password reset email dispatch.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "email": {
                            "type": "string",
                            "format": "email"
                          }
                        },
                        "required": [
                          "email"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Reset email queued."
                  },
                  "404": {
                    "description": "Account not found."
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Registration & Profile Service",
        "description": "User creation, onboarding preferences, and authenticated profile management (view/update, avatar).",
        "files": [
          "app/Controllers/Api/AuthController.php",
          "app/Controllers/ProfileController.php",
          "app/Controllers/ProfileImageController.php",
          "app/Models/User.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Registration & Profile API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/register": {
              "post": {
                "summary": "Register a new Bishwo Calculator user.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "username": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string",
                            "format": "email"
                          },
                          "password": {
                            "type": "string",
                            "minLength": 8
                          },
                          "first_name": {
                            "type": "string"
                          },
                          "last_name": {
                            "type": "string"
                          },
                          "terms_agree": {
                            "type": "boolean"
                          }
                        },
                        "required": [
                          "username",
                          "email",
                          "password"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "User created and ID returned."
                  },
                  "400": {
                    "description": "Validation failure."
                  },
                  "409": {
                    "description": "Username or email already exists."
                  }
                }
              }
            },
            "/profile": {
              "get": {
                "summary": "Retrieve profile for current session user.",
                "responses": {
                  "200": {
                    "description": "Profile payload."
                  },
                  "401": {
                    "description": "Session required."
                  }
                }
              },
              "put": {
                "summary": "Update profile info and preferences.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "first_name": {
                            "type": "string"
                          },
                          "last_name": {
                            "type": "string"
                          },
                          "company": {
                            "type": "string"
                          },
                          "phone": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Profile updated."
                  },
                  "400": {
                    "description": "Validation error."
                  },
                  "401": {
                    "description": "Unauthorized."
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Admin Panel & Access Control",
        "description": "Server-rendered admin dashboard, configuration panels, and middleware enforcing admin-only routes.",
        "files": [
          "app/Controllers/Admin/MainDashboardController.php",
          "app/Controllers/Admin/SettingsController.php",
          "app/Controllers/Admin/UserManagementController.php",
          "app/Middleware/AdminMiddleware.php",
          "app/routes.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Admin Panel API",
            "version": "1.0.0"
          },
          "paths": {
            "/admin": {
              "get": {
                "summary": "Render dashboard overview.",
                "responses": {
                  "200": {
                    "description": "HTML dashboard."
                  },
                  "302": {
                    "description": "Redirect to login when not authenticated."
                  },
                  "403": {
                    "description": "Forbidden for non-admins."
                  }
                }
              }
            },
            "/admin/settings/{section}": {
              "get": {
                "summary": "Return the requested settings section UI.",
                "parameters": [
                  {
                    "name": "section",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string",
                      "enum": [
                        "general",
                        "users",
                        "security",
                        "email",
                        "advanced"
                      ]
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Section HTML rendered."
                  },
                  "404": {
                    "description": "Section not found."
                  }
                }
              }
            },
            "/admin/users": {
              "get": {
                "summary": "List and manage registered users.",
                "responses": {
                  "200": {
                    "description": "User management table."
                  },
                  "403": {
                    "description": "Forbidden."
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Calculator Engine API",
        "description": "Modular calculators (electrical, civil, fire, etc.) with REST endpoints to list calculators and execute formulas.",
        "files": [
          "app/Controllers/CalculatorController.php",
          "app/Core/CalculatorEngine.php",
          "modules/electrical/",
          "modules/civil/",
          "modules/fire/"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Calculator API",
            "version": "1.0.0"
          },
          "paths": {
            "/calculators": {
              "get": {
                "summary": "Return categorized calculator definitions.",
                "responses": {
                  "200": {
                    "description": "JSON array of calculators."
                  }
                }
              }
            },
            "/calculator/{module}/{function}": {
              "post": {
                "summary": "Execute a calculator function with numeric inputs.",
                "parameters": [
                  {
                    "name": "module",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "function",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "inputs": {
                            "type": "object",
                            "additionalProperties": {
                              "type": "number"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Computation result payload."
                  },
                  "400": {
                    "description": "Invalid input or validation error."
                  },
                  "404": {
                    "description": "Unknown module or function."
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Theme & Plugin Management",
        "description": "Admin tooling to list/activate themes, customize branding, and toggle plugin modules at runtime.",
        "files": [
          "app/Controllers/Admin/ThemeController.php",
          "app/Controllers/Admin/ThemeCustomizeController.php",
          "app/Controllers/Admin/PluginController.php",
          "app/Services/ThemeBuilder.php",
          "app/Services/PluginManager.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Theme & Plugin API",
            "version": "1.0.0"
          },
          "paths": {
            "/admin/themes": {
              "get": {
                "summary": "List installed themes and active status.",
                "responses": {
                  "200": {
                    "description": "Theme list."
                  },
                  "403": {
                    "description": "Forbidden."
                  }
                }
              }
            },
            "/admin/themes/{theme}/activate": {
              "post": {
                "summary": "Activate selected theme.",
                "parameters": [
                  {
                    "name": "theme",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Theme activated."
                  },
                  "404": {
                    "description": "Theme missing."
                  }
                }
              }
            },
            "/admin/plugins": {
              "get": {
                "summary": "List installed plugins with status.",
                "responses": {
                  "200": {
                    "description": "Plugin list."
                  }
                }
              }
            },
            "/admin/plugins/toggle": {
              "post": {
                "summary": "Activate or deactivate a plugin.",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "plugin": {
                            "type": "string"
                          },
                          "action": {
                            "type": "string",
                            "enum": [
                              "activate",
                              "deactivate"
                            ]
                          }
                        },
                        "required": [
                          "plugin",
                          "action"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Plugin state updated."
                  },
                  "400": {
                    "description": "Invalid payload."
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
