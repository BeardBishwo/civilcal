{
  "meta": {
    "project": "EngiCal Pro",
    "date": "2025-11-19",
    "prepared_by": "Automated PRD Generator"
  },
  "product_overview": "EngiCal Pro is a premium, modular, enterprise-grade web-based calculation platform designed for Architecture, Engineering, and Construction (AEC) professionals. It delivers over 250 specialized engineering calculators across 10 engineering disciplines through a modern, scalable SaaS architecture, featuring comprehensive user management, payment integration, and advanced performance monitoring.",
  "core_goals": [
    "Provide a modular and extensible suite of 250+ professional engineering calculators covering diverse AEC disciplines.",
    "Deliver enterprise-grade features including multi-tenant architecture, role-based access control (RBAC), audit logging, and secure authentication.",
    "Ensure high performance and scalability with optimized database connectivity, caching layers, and real-time system monitoring.",
    "Offer a seamless user experience with responsive, accessible UI, multi-theme support, and comprehensive export/reporting capabilities.",
    "Enable third-party integrations through a robust API-first design including payment gateways and developer portal."
  ],
  "key_features": [
    "Comprehensive Calculator Suite with 250+ calculators across civil, electrical, HVAC, plumbing, fire protection, MEP coordination, estimation, structural, site development, and project management domains.",
    "Robust User Management with email/password login, social OAuth, two-factor authentication, session management, and detailed user profiles.",
    "Multi-tenant Architecture with tenant isolation, resource quotas, custom branding, and automated provisioning.",
    "Payment & Subscription System supporting PayPal, Stripe, Mollie; recurring billing; invoice management; and webhook notifications.",
    "Export & Reporting Module supporting PDF, Excel, CSV exports with customizable templates and batch capabilities.",
    "API & Developer Tools including RESTful API with token authentication, rate limiting, webhook support, and interactive documentation.",
    "Theme & Customization System featuring multi-theme support, dark/light mode, white-label capabilities, and CSS variable theming.",
    "Plugin System enabling modular extensions for calculators, payment gateways, exports, and themes with admin management.",
    "Image Management handling optimized uploads and storage for logos, favicons, banners, and profile photos.",
    "Security Features covering bcrypt password hashing, CSRF protection, SQL injection prevention, XSS protection, rate limiting, and GDPR compliance.",
    "Advanced Performance Optimization with connection pooling, caching layers, query optimization, real-time monitoring, and performance dashboards."
  ],
  "user_flow_summary": [
    "Guest users can browse calculators with limited access and view pricing/plans without authentication.",
    "Registered users can authenticate via email/password or social login, manage profiles, save calculations, and organize projects.",
    "Premium users access unlimited calculators, save and export calculations, customize templates, and API access with priority support.",
    "Admins have access to the admin panel for user management, system analytics, settings configuration, plugin management, and audit logs.",
    "Users can perform calculations through web UI or API endpoints with input validation, and receive results with export options.",
    "Payment and subscription flows enable users to select plans, process payments securely, and manage subscriptions.",
    "On system administration, admin users monitor system health and performance via dashboards with interactive control and alerts."
  ],
  "validation_criteria": [
    "All core calculator modules execute accurate calculations with input validation and return expected results.",
    "User authentication and session management enforce secure access and handle all edge cases including password reset and two-factor authentication.",
    "Admin panel and API endpoints perform CRUD operations securely respecting role permissions and error handling.",
    "Performance monitoring metrics report real-time system stats with less than 1% error rate and detect bottlenecks correctly.",
    "API requests enforce rate limiting and return proper responses for authentication, validation, and error conditions.",
    "Export functionality generates PDF, Excel, and CSV files matching templates and containing correct data.",
    "Security mechanisms prevent common vulnerabilities including SQL injection, CSRF, XSS, and password attacks.",
    "Database connectivity is robust with connection pooling and retry logic handling failures gracefully.",
    "UI and dashboards render responsively across devices with consistent appearance and performance.",
    "All automated tests pass (10/10) including integration, security, performance, and functional tests."
  ],
  "code_summary": {
    "tech_stack": [
      "PHP 7.4+",
      "Custom MVC Framework",
      "FastRoute Router",
      "Composer",
      "MySQL / MariaDB",
      "Twig-like Custom View Layer",
      "Session + Cookie Auth",
      "REST-style JSON APIs"
    ],
    "features": [
      {
        "name": "Authentication API",
        "description": "Login, registration, logout, username availability, remember-me, and password reset endpoints for first-party clients.",
        "files": [
          "app/Controllers/Api/AuthController.php",
          "app/Controllers/AuthController.php",
          "app/Core/Auth.php",
          "app/Middleware/AuthMiddleware.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Authentication API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/login": {
              "post": {
                "summary": "Authenticate with username/email + password",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "username": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "password": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Login success with session + auth token"
                  },
                  "400": {
                    "description": "Missing credentials"
                  },
                  "401": {
                    "description": "Invalid credentials"
                  }
                }
              }
            },
            "/api/register": {
              "post": {
                "summary": "Create a user with name, email, password, roles, agreements",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "username": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string",
                            "format": "email"
                          },
                          "password": {
                            "type": "string"
                          },
                          "full_name": {
                            "type": "string"
                          },
                          "engineer_roles": {
                            "type": "array",
                            "items": {
                              "type": "string"
                            }
                          }
                        },
                        "required": [
                          "username",
                          "email",
                          "password",
                          "full_name",
                          "engineer_roles"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Registration success"
                  },
                  "400": {
                    "description": "Validation failure"
                  },
                  "500": {
                    "description": "Server error"
                  }
                }
              }
            },
            "/api/logout": {
              "get": {
                "summary": "Destroy current session",
                "responses": {
                  "200": {
                    "description": "Logout success"
                  },
                  "401": {
                    "description": "Not authenticated"
                  }
                }
              }
            },
            "/api/check-username": {
              "post": {
                "summary": "Check username availability and suggestions",
                "responses": {
                  "200": {
                    "description": "Availability result"
                  },
                  "400": {
                    "description": "Bad request"
                  }
                }
              }
            },
            "/api/forgot-password": {
              "post": {
                "summary": "Initiate password reset",
                "responses": {
                  "200": {
                    "description": "Reset email enqueued"
                  },
                  "400": {
                    "description": "Missing email"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Admin Panel System",
        "description": "Server-rendered admin dashboard providing system stats, configuration, plugin/theme management, and logs.",
        "files": [
          "app/Controllers/Admin/MainDashboardController.php",
          "app/Controllers/Admin/SettingsController.php",
          "app/Controllers/Admin/UserManagementController.php",
          "app/Controllers/Admin/ThemeController.php",
          "app/Controllers/Admin/PluginController.php",
          "app/Controllers/Admin/SystemStatusController.php",
          "app/Middleware/AdminMiddleware.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Admin Panel API",
            "version": "1.0.0"
          },
          "paths": {
            "/admin": {
              "get": {
                "summary": "Render dashboard",
                "responses": {
                  "200": {
                    "description": "Dashboard view"
                  },
                  "302": {
                    "description": "Redirect when unauthenticated"
                  },
                  "403": {
                    "description": "Forbidden for non-admin"
                  }
                }
              }
            },
            "/admin/settings/{section}": {
              "get": {
                "summary": "Render specific settings section",
                "parameters": [
                  {
                    "name": "section",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string",
                      "enum": [
                        "general",
                        "users",
                        "security",
                        "email",
                        "api",
                        "performance",
                        "advanced"
                      ]
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Section rendered"
                  },
                  "403": {
                    "description": "Forbidden"
                  },
                  "404": {
                    "description": "Unknown section"
                  }
                }
              }
            },
            "/admin/users": {
              "get": {
                "summary": "User list view",
                "responses": {
                  "200": {
                    "description": "HTML table of users"
                  },
                  "403": {
                    "description": "Forbidden"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Calculator Engine API",
        "description": "Modular calculation engine with endpoints for listing calculators and executing discipline-specific calculations.",
        "files": [
          "app/Controllers/CalculatorController.php",
          "modules/electrical/",
          "modules/civil/",
          "modules/fire/",
          "app/Core/CalculatorEngine.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Calculator API",
            "version": "1.0.0"
          },
          "paths": {
            "/calculators": {
              "get": {
                "summary": "List calculators grouped by module",
                "responses": {
                  "200": {
                    "description": "JSON list of calculators"
                  }
                }
              }
            },
            "/calculator/{module}/{function}": {
              "post": {
                "summary": "Execute a calculation routine",
                "parameters": [
                  {
                    "name": "module",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  },
                  {
                    "name": "function",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "input_values": {
                            "type": "object",
                            "additionalProperties": {
                              "type": "number"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Result payload"
                  },
                  "400": {
                    "description": "Validation error"
                  },
                  "404": {
                    "description": "Unknown calculator"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "User Profile Service",
        "description": "Authenticated profile reads + updates including avatar upload endpoints.",
        "files": [
          "app/Controllers/ProfileController.php",
          "app/Controllers/ProfileImageController.php",
          "app/Models/User.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "User Profile API",
            "version": "1.0.0"
          },
          "paths": {
            "/profile": {
              "get": {
                "summary": "Fetch profile for the logged-in user",
                "responses": {
                  "200": {
                    "description": "Profile JSON"
                  },
                  "401": {
                    "description": "Requires authentication"
                  }
                }
              },
              "put": {
                "summary": "Update profile fields",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "first_name": {
                            "type": "string"
                          },
                          "last_name": {
                            "type": "string"
                          },
                          "company": {
                            "type": "string"
                          },
                          "bio": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Profile updated"
                  },
                  "400": {
                    "description": "Validation error"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Theme Management",
        "description": "Admin endpoints for listing, previewing, and activating frontend themes plus customization states.",
        "files": [
          "app/Controllers/Admin/ThemeController.php",
          "app/Controllers/Admin/ThemeCustomizeController.php",
          "themes/",
          "app/Services/ThemeBuilder.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Theme Management API",
            "version": "1.0.0"
          },
          "paths": {
            "/admin/themes": {
              "get": {
                "summary": "List themes and metadata",
                "responses": {
                  "200": {
                    "description": "Theme list"
                  },
                  "403": {
                    "description": "Forbidden"
                  }
                }
              }
            },
            "/admin/themes/{theme}/activate": {
              "post": {
                "summary": "Activate theme",
                "parameters": [
                  {
                    "name": "theme",
                    "in": "path",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Activation success"
                  },
                  "404": {
                    "description": "Theme not found"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Plugin System",
        "description": "Admin APIs for listing plugins, toggling activation, and managing plugin metadata.",
        "files": [
          "app/Controllers/Admin/PluginController.php",
          "app/Services/PluginManager.php",
          "plugins/"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Plugin API",
            "version": "1.0.0"
          },
          "paths": {
            "/admin/plugins": {
              "get": {
                "summary": "List installed plugins",
                "responses": {
                  "200": {
                    "description": "Plugin list"
                  },
                  "403": {
                    "description": "Forbidden"
                  }
                }
              }
            },
            "/admin/plugins/toggle": {
              "post": {
                "summary": "Activate or deactivate a plugin",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "plugin": {
                            "type": "string"
                          },
                          "action": {
                            "type": "string",
                            "enum": [
                              "activate",
                              "deactivate"
                            ]
                          }
                        },
                        "required": [
                          "plugin",
                          "action"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "State updated"
                  },
                  "400": {
                    "description": "Invalid payload"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Payment & Subscription",
        "description": "Subscription plan listing and payment processing endpoints for premium tiers.",
        "files": [
          "app/Controllers/PaymentController.php",
          "app/Controllers/Admin/SubscriptionController.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Payment API",
            "version": "1.0.0"
          },
          "paths": {
            "/payment": {
              "post": {
                "summary": "Process a payment intent",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "amount": {
                            "type": "number"
                          },
                          "currency": {
                            "type": "string"
                          },
                          "payment_method": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "amount",
                          "currency",
                          "payment_method"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Payment processed"
                  },
                  "400": {
                    "description": "Validation error"
                  }
                }
              }
            },
            "/admin/subscriptions": {
              "get": {
                "summary": "List subscription plans and status",
                "responses": {
                  "200": {
                    "description": "Subscription data"
                  },
                  "403": {
                    "description": "Forbidden"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "API Administration",
        "description": "JSON endpoints exposing dashboard metrics and health checks for monitoring.",
        "files": [
          "app/Controllers/Api/AdminController.php",
          "app/Controllers/Api/V1/HealthController.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Admin API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/admin/dashboard/stats": {
              "get": {
                "summary": "Retrieve aggregated metrics",
                "responses": {
                  "200": {
                    "description": "Stats payload"
                  },
                  "403": {
                    "description": "Forbidden"
                  }
                }
              }
            },
            "/api/admin/system/health": {
              "get": {
                "summary": "System health probe",
                "responses": {
                  "200": {
                    "description": "Healthy"
                  },
                  "500": {
                    "description": "Service degraded"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Export / Import",
        "description": "Endpoints for exporting calculation results and importing structured data.",
        "files": [
          "app/Controllers/ExportController.php",
          "app/Services/DataExporter.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Export API",
            "version": "1.0.0"
          },
          "paths": {
            "/export": {
              "post": {
                "summary": "Generate an export in PDF/CSV/XLSX",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "format": {
                            "type": "string",
                            "enum": [
                              "pdf",
                              "excel",
                              "csv"
                            ]
                          },
                          "data_type": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "format",
                          "data_type"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Export ready"
                  },
                  "400": {
                    "description": "Invalid parameters"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
