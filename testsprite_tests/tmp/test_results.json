[
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "ce76abac-d4fe-4ea9-9f74-fef415c8cea8",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC001-verify_calculator_navigation_and_display",
    "description": "Test that the user can navigate calculators via the dynamic dropdown on the home page and that the selected calculator page loads correctly without errors.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nTIMEOUT = 30\n\ndef test_verify_calculator_navigation_and_display():\n    session = requests.Session()\n    session.auth = AUTH\n\n    endpoints = [\n        \"/profile\",\n        \"/admin\",\n        \"/help\"\n    ]\n\n    php_warning_indicators = [\n        \"Warning: \",\n        \"Deprecated:\",\n        \"Notice:\",\n        \"Fatal error\",\n        \"Call to undefined function\",\n        \"undefined index\",\n        \"missing table\",\n        \"mysqli_sql_exception\",\n        \"PDOException\"\n    ]\n\n    for endpoint in endpoints:\n        url = BASE_URL + endpoint\n        try:\n            response = session.get(url, timeout=TIMEOUT)\n        except requests.RequestException as e:\n            assert False, f\"Request to {url} failed with exception: {e}\"\n\n        assert response.status_code == 200, f\"Unexpected status code {response.status_code} for {url}\"\n        content = response.text\n\n        # Check that there are no PHP warnings or missing table errors in the page content\n        for indicator in php_warning_indicators:\n            assert indicator not in content, f\"Found PHP warning or error indicator '{indicator}' in response from {url}\"\n\n    # Additional check: simulate dynamic dropdown on home page to get list of calculators\n    home_url = BASE_URL + \"/\"\n    try:\n        home_response = session.get(home_url, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request to {home_url} failed with exception: {e}\"\n\n    assert home_response.status_code == 200, f\"Unexpected status code {home_response.status_code} for home page\"\n\n    home_content = home_response.text.lower()\n\n    # Basic check that some calculator-related terms or dropdown options exist\n    calculator_keywords = [\"dropdown\", \"calculator\", \"select\", \"option\"]\n    assert any(keyword in home_content for keyword in calculator_keywords), \"Home page does not contain calculator navigation elements\"\n\ntest_verify_calculator_navigation_and_display()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.183Z",
    "modified": "2025-11-14T07:39:05.111Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "c14cd10b-4316-4479-9b99-ed9388dcd80a",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC002-validate_theme_upload_activation_and_dynamic_css_application",
    "description": "Test the theme management workflow by uploading a new theme, validating it against rules, activating it, customizing settings, and verifying that dynamic CSS is applied correctly on the front end.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nTIMEOUT = 30\nHEADERS = {\n    \"Accept\": \"application/json\"\n}\n\ndef test_validate_theme_upload_activation_and_dynamic_css_application():\n    theme_upload_url = f\"{BASE_URL}/admin/themes/upload\"\n    theme_validate_url = f\"{BASE_URL}/admin/themes/validate\"\n    theme_activate_url = f\"{BASE_URL}/admin/themes/activate\"\n    theme_customize_url = f\"{BASE_URL}/admin/themes/customize\"\n    profile_page_url = f\"{BASE_URL}/profile\"\n    admin_dashboard_url = f\"{BASE_URL}/admin\"\n    help_center_url = f\"{BASE_URL}/help\"\n\n    # Example minimal theme package payload (mocked as JSON for upload simulation)\n    # Assuming the API accepts multipart/form-data with file upload,\n    # we will simulate a simple theme zip upload using bytes in-memory.\n    theme_file_content = b\"PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\"  # minimal zip header bytes\n    files = {\n        \"theme_package\": (\"test_theme.zip\", theme_file_content, \"application/zip\")\n    }\n\n    # Upload Theme\n    try:\n        upload_resp = requests.post(theme_upload_url, auth=AUTH, files=files, timeout=TIMEOUT)\n        assert upload_resp.status_code == 201, f\"Theme upload failed: {upload_resp.status_code} {upload_resp.text}\"\n        upload_data = upload_resp.json()\n        assert \"theme_id\" in upload_data, \"theme_id missing in upload response\"\n        theme_id = upload_data[\"theme_id\"]\n\n        # Validate Theme\n        validate_resp = requests.post(theme_validate_url, auth=AUTH, json={\"theme_id\": theme_id}, timeout=TIMEOUT)\n        assert validate_resp.status_code == 200, f\"Theme validation failed: {validate_resp.status_code} {validate_resp.text}\"\n        validate_data = validate_resp.json()\n        assert validate_data.get(\"valid\") is True, f\"Theme validation returned invalid: {validate_data}\"\n\n        # Activate Theme\n        activate_resp = requests.post(theme_activate_url, auth=AUTH, json={\"theme_id\": theme_id}, timeout=TIMEOUT)\n        assert activate_resp.status_code == 200, f\"Theme activation failed: {activate_resp.status_code} {activate_resp.text}\"\n        activate_data = activate_resp.json()\n        assert activate_data.get(\"activated\") is True, f\"Theme was not activated: {activate_data}\"\n\n        # Customize Theme Settings (example customization payload)\n        customization_payload = {\n            \"theme_id\": theme_id,\n            \"settings\": {\n                \"primary_color\": \"#123456\",\n                \"font_size\": \"16px\",\n                \"custom_css\": \".dynamic-test { color: red; }\"\n            }\n        }\n        customize_resp = requests.post(theme_customize_url, auth=AUTH, json=customization_payload, timeout=TIMEOUT)\n        assert customize_resp.status_code == 200, f\"Theme customization failed: {customize_resp.status_code} {customize_resp.text}\"\n        customize_data = customize_resp.json()\n        assert customize_data.get(\"customized\") is True, f\"Theme customization not applied properly: {customize_data}\"\n\n        # Verify dynamic CSS application on profile page\n        profile_resp = requests.get(profile_page_url, auth=AUTH, timeout=TIMEOUT)\n        assert profile_resp.status_code == 200, f\"Profile page load failed: {profile_resp.status_code}\"\n        profile_text = profile_resp.text.lower()\n        assert \"dynamic-test\" in profile_text, \"Dynamic CSS class not found on profile page\"\n        assert \"php warning\" not in profile_text, \"PHP warnings found on profile page\"\n        assert \"missing table\" not in profile_text, \"Missing table errors found on profile page\"\n\n        # Verify no PHP warnings or missing table errors on admin dashboard page\n        admin_resp = requests.get(admin_dashboard_url, auth=AUTH, timeout=TIMEOUT)\n        assert admin_resp.status_code == 200, f\"Admin dashboard load failed: {admin_resp.status_code}\"\n        admin_text = admin_resp.text.lower()\n        assert \"php warning\" not in admin_text, \"PHP warnings found on admin dashboard\"\n        assert \"missing table\" not in admin_text, \"Missing table errors found on admin dashboard\"\n\n        # Verify navigation to help center page works and no errors there\n        help_resp = requests.get(help_center_url, auth=AUTH, timeout=TIMEOUT)\n        assert help_resp.status_code == 200, f\"Help center load failed: {help_resp.status_code}\"\n        help_text = help_resp.text.lower()\n        assert \"php warning\" not in help_text, \"PHP warnings found on help center\"\n        assert \"missing table\" not in help_text, \"Missing table errors found on help center\"\n\n    finally:\n        # Cleanup - delete theme if API for deletion exists\n        theme_delete_url = f\"{BASE_URL}/admin/themes/delete\"\n        try:\n            del_resp = requests.post(theme_delete_url, auth=AUTH, json={\"theme_id\": theme_id}, timeout=TIMEOUT)\n            # No assertion on delete response; just best effort cleanup\n        except Exception:\n            pass\n\n\ntest_validate_theme_upload_activation_and_dynamic_css_application()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 94, in <module>\n  File \"<string>\", line 31, in test_validate_theme_upload_activation_and_dynamic_css_application\nAssertionError: Theme upload failed: 200 <!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Sign In - EngiCal Pro</title>\n    <link rel=\"icon\" href=\"assets/images/favicon.png\">\n    <link rel=\"preconnect\" href=\"https://cdnjs.cloudflare.com\" crossorigin>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\">\n</head>\n<body>\n\n<div class=\"auth-container\">\n    <div class=\"auth-card\">\n        <!-- Header Section -->\n        <div class=\"auth-header\">\n            <h1>Welcome Back</h1>\n            <p class=\"auth-subtitle\">Sign in to your EngiCal Pro account</p>\n        </div>\n\n        <form id=\"loginForm\" class=\"auth-form\">\n            <input type=\"hidden\" name=\"csrf_token\" value=\"6d793dd1b2ceb30814021125ef63d32774c1f19028c11f1a1a33a0d6dc8a54ee\">\n            \n            <!-- Login Fields -->\n            <div class=\"form-section\">\n                <div class=\"form-group\">\n                    <label for=\"username_email\">Username or Email</label>\n                    <input type=\"text\" \n                           id=\"username_email\" \n                           name=\"username_email\" \n                           class=\"form-control\" \n                           placeholder=\"Enter your username or email\"\n                           autocomplete=\"username\"\n                           required>\n                    <div class=\"field-message\">Enter your username or email address</div>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"password\">Password</label>\n                    <div class=\"password-field\">\n                        <input type=\"password\" \n                               id=\"password\" \n                               name=\"password\" \n                               class=\"form-control\" \n                               placeholder=\"Enter your password\"\n                               autocomplete=\"current-password\"\n                               required>\n                        <button type=\"button\" class=\"password-toggle\" id=\"togglePassword\">\n                            <i class=\"fas fa-eye\"></i>\n                        </button>\n                    </div>\n                </div>\n\n                <!-- Remember Me & Forgot Password -->\n                <div class=\"form-options\">\n                    <label class=\"checkbox-item remember-me\">\n                        <input type=\"checkbox\" id=\"remember_me\" name=\"remember_me\">\n                        <span class=\"checkmark\"></span>\n                        <span class=\"checkbox-text\">Remember me for 30 days</span>\n                    </label>\n                    \n                    <a href=\"/Bishwo_Calculator/forgot-password\" class=\"forgot-link\">Forgot your password?</a>\n                </div>\n            </div>\n\n            <!-- Security Features Info -->\n            <div class=\"security-notice\">\n                <i class=\"fas fa-shield-alt\"></i>\n                <div class=\"security-text\">\n                    <strong>Your account is protected with:</strong>\n                    <ul>\n                        <li>Secure password hashing</li>\n                        <li>CSRF attack protection</li>\n                        <li>Session-based authentication</li>\n                        <li>Input validation and sanitization</li>\n                    </ul>\n                </div>\n            </div>\n\n            <!-- Submit Button -->\n            <div class=\"form-actions\">\n                <button type=\"submit\" class=\"btn btn-primary btn-lg\" id=\"loginBtn\">\n                    <span class=\"btn-text\">\n                        <i class=\"fas fa-sign-in-alt\"></i>\n                        Sign In\n                    </span>\n                    <span class=\"btn-loading\" style=\"display: none;\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        Signing In...\n                    </span>\n                </button>\n            </div>\n\n            <!-- Login Result -->\n            <div id=\"loginResult\" class=\"result-message\" style=\"display: none;\"></div>\n        </form>\n\n        <!-- Registration Link -->\n        <div class=\"auth-footer\">\n            <p>Don't have an account? <a href=\"/Bishwo_Calculator/register\" class=\"auth-link\">Create Professional Account</a></p>\n            <p class=\"footer-note\">\n                <i class=\"fas fa-info-circle\"></i>\n                Join thousands of engineers using Civil Calculator\n            </p>\n        </div>\n    </div>\n</div>\n\n<!-- Quick Login Demo Section -->\n<div class=\"demo-section\">\n    <div class=\"demo-card\">\n        <h3><i class=\"fas fa-rocket\"></i> Quick Demo Access</h3>\n        <p>Try the enhanced authentication system with these demo accounts:</p>\n        \n        <div class=\"demo-accounts\">\n            <div class=\"demo-account\">\n                <strong>Engineer Demo:</strong>\n                <div class=\"demo-credentials\">\n                    <code>engineer@engicalpro.com</code>\n                    <code>Engineer123!</code>\n                    <button class=\"btn btn-sm demo-login\" data-email=\"engineer@engicalpro.com\" data-password=\"Engineer123!\">\n                        <i class=\"fas fa-bolt\"></i> Quick Login\n                    </button>\n                </div>\n            </div>\n            \n            <div class=\"demo-account\">\n                <strong>Admin Demo:</strong>\n                <div class=\"demo-credentials\">\n                    <code>admin@engicalpro.com</code>\n                    <code>password</code>\n                    <button class=\"btn btn-sm demo-login\" data-email=\"admin@engicalpro.com\" data-password=\"password\">\n                        <i class=\"fas fa-bolt\"></i> Quick Login\n                    </button>\n                </div>\n            </div>\n            \n            <div class=\"demo-account\">\n                <strong>Your Personal Account:</strong>\n                <div class=\"demo-credentials\">\n                    <code>uniquebishwo@gmail.com</code>\n                    <code>c9PU7XAsAADYk_A</code>\n                    <button class=\"btn btn-sm demo-login\" data-email=\"uniquebishwo@gmail.com\" data-password=\"c9PU7XAsAADYk_A\">\n                        <i class=\"fas fa-user-crown\"></i> Personal Login\n                    </button>\n                </div>\n            </div>\n        </div>\n        \n        <p class=\"demo-note\">\n            <small><i class=\"fas fa-info-circle\"></i> These are demo credentials for testing purposes only.</small>\n        </p>\n    </div>\n</div>\n\n<!-- CSS Styles -->\n<style>\n.auth-container {\n    min-height: 100vh;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n}\n\n.auth-card {\n    background: white;\n    border-radius: 20px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);\n    overflow: hidden;\n    width: 100%;\n    max-width: 450px;\n}\n\n.auth-header {\n    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n    color: white;\n    text-align: center;\n    padding: 40px 30px;\n}\n\n.auth-header h1 {\n    margin: 0;\n    font-size: 2.2rem;\n    font-weight: 700;\n}\n\n.auth-subtitle {\n    margin: 10px 0 0;\n    font-size: 1rem;\n    opacity: 0.9;\n}\n\n.auth-form {\n    padding: 40px;\n}\n\n.form-section {\n    margin-bottom: 25px;\n}\n\n.form-group {\n    margin-bottom: 20px;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 8px;\n    font-weight: 600;\n    color: #374151;\n}\n\n.form-control {\n    width: 100%;\n    padding: 14px 18px;\n    border: 2px solid #d1d5db;\n    border-radius: 10px;\n    font-size: 1rem;\n    transition: all 0.2s ease;\n    box-sizing: border-box;\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: #4f46e5;\n    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);\n}\n\n.field-message {\n    font-size: 0.875rem;\n    color: #6b7280;\n    margin-top: 5px;\n}\n\n.password-field {\n    position: relative;\n}\n\n.password-toggle {\n    position: absolute;\n    right: 14px;\n    top: 50%;\n    transform: translateY(-50%);\n    background: none;\n    border: none;\n    color: #6b7280;\n    cursor: pointer;\n    font-size: 1rem;\n    padding: 5px;\n}\n\n.password-toggle:hover {\n    color: #4f46e5;\n}\n\n.form-options {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin: 20px 0;\n    flex-wrap: wrap;\n    gap: 15px;\n}\n\n.remember-me {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    cursor: pointer;\n}\n\n.remember-me input[type=\"checkbox\"] {\n    position: absolute;\n    opacity: 0;\n    cursor: pointer;\n}\n\n.remember-me .checkmark {\n    height: 18px;\n    width: 18px;\n    background-color: #fff;\n    border: 2px solid #d1d5db;\n    border-radius: 4px;\n    position: relative;\n    flex-shrink: 0;\n    transition: all 0.2s ease;\n}\n\n.remember-me input[type=\"checkbox\"]:checked ~ .checkmark {\n    background-color: #4f46e5;\n    border-color: #4f46e5;\n}\n\n.remember-me input[type=\"checkbox\"]:checked ~ .checkmark:after {\n    display: block;\n}\n\n.remember-me .checkmark:after {\n    content: \"\";\n    position: absolute;\n    display: none;\n    left: 5px;\n    top: 1px;\n    width: 6px;\n    height: 10px;\n    border: solid white;\n    border-width: 0 2px 2px 0;\n    transform: rotate(45deg);\n}\n\n.remember-me .checkbox-text {\n    font-size: 0.9rem;\n    color: #374151;\n}\n\n.forgot-link {\n    color: #4f46e5;\n    text-decoration: none;\n    font-size: 0.9rem;\n    font-weight: 500;\n}\n\n.forgot-link:hover {\n    text-decoration: underline;\n}\n\n.security-notice {\n    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n    border: 1px solid #bae6fd;\n    border-radius: 10px;\n    padding: 20px;\n    margin: 25px 0;\n    display: flex;\n    gap: 15px;\n    align-items: flex-start;\n}\n\n.security-notice i {\n    color: #0369a1;\n    font-size: 1.5rem;\n    margin-top: 2px;\n    flex-shrink: 0;\n}\n\n.security-text {\n    flex: 1;\n}\n\n.security-text strong {\n    color: #0c4a6e;\n    font-size: 0.9rem;\n    display: block;\n    margin-bottom: 8px;\n}\n\n.security-text ul {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n}\n\n.security-text li {\n    color: #0c4a6e;\n    font-size: 0.85rem;\n    margin: 4px 0;\n    padding-left: 15px;\n    position: relative;\n}\n\n.security-text li:before {\n    content: \"âœ“\";\n    color: #059669;\n    font-weight: bold;\n    position: absolute;\n    left: 0;\n}\n\n.form-actions {\n    text-align: center;\n    margin: 30px 0;\n}\n\n.btn {\n    padding: 12px 24px;\n    border: none;\n    border-radius: 10px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.btn-primary {\n    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n    color: white;\n    padding: 16px 40px;\n    font-size: 1.1rem;\n    width: 100%;\n    justify-content: center;\n}\n\n.btn-primary:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);\n}\n\n.btn-primary:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n}\n\n.btn-sm {\n    padding: 8px 16px;\n    font-size: 0.875rem;\n}\n\n.result-message {\n    margin: 20px 0;\n    padding: 15px;\n    border-radius: 8px;\n    text-align: center;\n    font-weight: 500;\n}\n\n.result-message.success {\n    background-color: #d1fae5;\n    color: #065f46;\n    border: 1px solid #10b981;\n}\n\n.result-message.error {\n    background-color: #fee2e2;\n    color: #991b1b;\n    border: 1px solid #ef4444;\n}\n\n.result-message.warning {\n    background-color: #fef3c7;\n    color: #92400e;\n    border: 1px solid #f59e0b;\n}\n\n.auth-footer {\n    text-align: center;\n    padding: 30px;\n    background-color: #f9fafb;\n    border-top: 1px solid #e5e7eb;\n}\n\n.auth-footer p {\n    color: #374151; /* Darker text color */\n    margin: 0 0 10px 0;\n}\n\n.auth-link {\n    color: #4f46e5;\n    text-decoration: none;\n    font-weight: 600;\n}\n\n.auth-link:hover {\n    text-decoration: underline;\n}\n\n.footer-note {\n    margin-top: 15px;\n    font-size: 0.9rem;\n    color: #6b7280;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n}\n\n/* Demo Section */\n.demo-section {\n    margin-top: 30px;\n    max-width: 450px;\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.demo-card {\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 15px;\n    padding: 25px;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\n}\n\n.demo-card h3 {\n    margin: 0 0 15px;\n    color: #374151;\n    font-size: 1.2rem;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.demo-card h3 i {\n    color: #4f46e5;\n}\n\n.demo-card p {\n    margin: 0 0 20px;\n    color: #6b7280;\n    font-size: 0.9rem;\n}\n\n.demo-accounts {\n    margin-bottom: 15px;\n}\n\n.demo-account {\n    background: #f8fafc;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    padding: 15px;\n    margin-bottom: 15px;\n}\n\n.demo-account:last-child {\n    margin-bottom: 0;\n}\n\n.demo-account strong {\n    color: #1e293b;\n    display: block;\n    margin-bottom: 10px;\n    font-size: 0.9rem;\n}\n\n.demo-credentials {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    flex-wrap: wrap;\n}\n\n.demo-credentials code {\n    background: #1e293b;\n    color: #f1f5f9;\n    padding: 4px 8px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    font-family: 'Courier New', monospace;\n}\n\n.demo-login {\n    background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);\n    color: white;\n    border: none;\n    padding: 10px 18px;\n    border-radius: 8px;\n    font-size: 0.875rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-top: 10px;\n    box-shadow: 0 2px 4px rgba(79, 70, 229, 0.2);\n    position: relative;\n    overflow: hidden;\n}\n\n.demo-login::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);\n    transition: left 0.5s;\n}\n\n.demo-login:hover::before {\n    left: 100%;\n}\n\n.demo-login:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);\n}\n\n.demo-login:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n}\n\n.demo-note {\n    margin-top: 15px;\n    text-align: center;\n}\n\n.demo-note small {\n    color: #6b7280;\n}\n\n@media (max-width: 768px) {\n    .auth-container {\n        padding: 10px;\n    }\n    \n    .auth-form {\n        padding: 25px;\n    }\n    \n    .form-options {\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 10px;\n    }\n    \n    .demo-credentials {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n    \n    .demo-credentials code {\n        width: 100%;\n    }\n    \n    .security-notice {\n        flex-direction: column;\n        text-align: center;\n    }\n    \n    .demo-card {\n        padding: 20px;\n    }\n}\n</style>\n\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js\"></script>\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n    initializeLoginForm();\n});\n\nfunction initializeLoginForm() {\n    // Password visibility toggle\n    document.getElementById('togglePassword').addEventListener('click', function() {\n        const passwordField = document.getElementById('password');\n        const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';\n        passwordField.setAttribute('type', type);\n        this.innerHTML = type === 'password' ? '<i class=\"fas fa-eye\"></i>' : '<i class=\"fas fa-eye-slash\"></i>';\n    });\n\n    // Form submission\n    document.getElementById('loginForm').addEventListener('submit', handleLoginSubmission);\n\n    // Demo login buttons with enhanced functionality\n    document.querySelectorAll('.demo-login').forEach(button => {\n        button.addEventListener('click', function(e) {\n            e.preventDefault();\n            \n            const email = this.dataset.email;\n            const password = this.dataset.password;\n            \n            // Add visual feedback\n            const originalText = this.innerHTML;\n            this.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Logging in...';\n            this.disabled = true;\n            \n            // Fill form fields with demo credentials\n            const usernameField = document.getElementById('username_email');\n            const passwordField = document.getElementById('password');\n            \n            if (usernameField && passwordField) {\n                usernameField.value = email;\n                passwordField.value = password;\n                \n                // Add a small delay for visual effect\n                setTimeout(() => {\n                    // Trigger form submission\n                    document.getElementById('loginForm').dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));\n                    \n                    // Reset button after a delay\n                    setTimeout(() => {\n                        this.innerHTML = originalText;\n                        this.disabled = false;\n                    }, 2000);\n                }, 500);\n            } else {\n                // Reset button if form fields not found\n                this.innerHTML = originalText;\n                this.disabled = false;\n                console.error('Login form fields not found');\n            }\n        });\n    });\n}\n\nasync function handleLoginSubmission(e) {\n    e.preventDefault();\n    \n    const form = e.target;\n    const submitBtn = document.getElementById('loginBtn');\n    const btnText = submitBtn.querySelector('.btn-text');\n    const btnLoading = submitBtn.querySelector('.btn-loading');\n    const resultDiv = document.getElementById('loginResult');\n    \n    // Show loading state\n    submitBtn.disabled = true;\n    btnText.style.display = 'none';\n    btnLoading.style.display = 'inline-flex';\n    resultDiv.style.display = 'none';\n    \n    try {\n        // Collect form data\n        const formData = new FormData(form);\n        const payload = {\n            username_email: formData.get('username_email'),\n            password: formData.get('password'),\n            remember_me: formData.get('remember_me') ? 1 : 0,\n            csrf_token: formData.get('csrf_token')\n        };\n        \n        console.log('Login request payload:', payload);\n        console.log('Login API URL:', '/Bishwo_Calculator/api/login');\n        \n        // Send login request to API endpoint\n        const response = await fetch('/Bishwo_Calculator/api/login', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n                'X-CSRF-Token': payload.csrf_token\n            },\n            credentials: 'include',\n            body: JSON.stringify(payload)\n        });\n        \n        console.log('Login response status:', response.status);\n        console.log('Login response headers:', response.headers);\n        \n        if (!response.ok) {\n            const errorText = await response.text();\n            console.error('Login response error:', errorText);\n            throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n        \n        const result = await response.json();\n        console.log('Login response data:', result);\n        \n                if (result.success) {\n            // Success\n            resultDiv.className = 'result-message success';\n            resultDiv.innerHTML = `\n                <i class=\"fas fa-check-circle\" style=\"font-size: 2rem; margin-bottom: 10px;\"></i>\n                <h3>Login Successful!</h3>\n                <p>${result.message || 'Welcome back! Redirecting to dashboard...'}</p>\n            `;\n            \n            // If email verification is required, show a message and don't redirect\n            if (result.email_verification_required) {\n                resultDiv.className = 'result-message warning';\n                resultDiv.innerHTML = `\n                    <i class=\"fas fa-exclamation-circle\" style=\"font-size: 2rem; margin-bottom: 10px;\"></i>\n                    <h3>Email Verification Required</h3>\n                    <p>${result.message || 'Please check your email to verify your account before signing in.'} <a href=\"/Bishwo_Calculator/verify\" style=\"color: #4f46e5;\">Check verification status</a></p>\n                `;\n                resultDiv.style.display = 'block';\n            } else {\n                // Update header immediately using returned user payload (avoid cookie timing issues)\n                try {\n                    if (window.applyHeaderUser && result.user) {\n                        // prefer explicit is_admin flag from API if available\n                        const isAdmin = !!result.is_admin || (result.user && result.user.role && result.user.role.toLowerCase() === 'admin');\n                        window.applyHeaderUser(result.user, isAdmin);\n                    } else if (window.refreshHeaderFromServer) {\n                        // fallback to server refresh\n                        await window.refreshHeaderFromServer();\n                    }\n                } catch (e) {\n                    console.warn('Header update failed', e);\n                }\n\n                // Redirect after short delay so user sees header update\n                setTimeout(() => {\n                    window.location.href = result.redirect_url || '/';\n                }, 500);\n            }\n                } else {\n            // Error\n            let errorMessage = result.error || 'Login failed';\n            \n            // Show specific error for email verification\n            if (result.email_verification_required) {\n                errorMessage += ' <a href=\"verify.php\" style=\"color: #4f46e5;\">Resend verification email</a>';\n                resultDiv.className = 'result-message warning';\n            } else {\n                resultDiv.className = 'result-message error';\n                } \n            \n            resultDiv.innerHTML = `\n                <i class=\"fas fa-exclamation-circle\" style=\"font-size: 2rem; margin-bottom: 10px;\"></i>\n                <h3>Login Failed</h3>\n                <p>${errorMessage}</p>\n            `;\n            \n            if (result.attempts_remaining !== undefined) {\n                resultDiv.innerHTML += `<p><small>Attempts remaining: ${result.attempts_remaining}</small></p>`;\n            }\n        }\n        \n    } catch (error) {\n        // Network or server error\n        console.error('Login error details:', {\n            message: error.message,\n            stack: error.stack,\n            name: error.name,\n            error: error\n        });\n        \n        let errorMessage = 'Unable to connect to server. Please check your internet connection and try again.';\n        let errorDetails = '';\n        \n        if (error.message) {\n            errorDetails = `<br><small>Error: ${error.message}</small>`;\n        }\n        \n        // Check if it's a network error or parsing error\n        if (error.name === 'SyntaxError') {\n            errorMessage = 'Server returned invalid response. Please try again.';\n            errorDetails = '<br><small>The server response could not be parsed.</small>';\n        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {\n            errorMessage = 'Network connection failed. Please check your internet connection.';\n            errorDetails = '<br><small>Unable to reach the login server.</small>';\n        }\n        \n        resultDiv.className = 'result-message error';\n        resultDiv.innerHTML = `\n            <i class=\"fas fa-exclamation-triangle\" style=\"font-size: 2rem; margin-bottom: 10px;\"></i>\n            <h3>Connection Error</h3>\n            <p>${errorMessage}${errorDetails}</p>\n        `;\n        \n    } finally {\n        // Reset button state\n        submitBtn.disabled = false;\n        btnText.style.display = 'inline-flex';\n        btnLoading.style.display = 'none';\n        resultDiv.style.display = 'block';\n        resultDiv.scrollIntoView({ behavior: 'smooth' });\n    }\n}\n</script>\n\n</body>\n</html>\n\n\n\n\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.188Z",
    "modified": "2025-11-14T07:39:29.057Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "17d46e79-0423-4ece-9df5-182ca6d47dd4",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC003-test_plugin_upload_toggle_and_manifest_validation",
    "description": "Test plugin management by uploading a new plugin, validating its manifest for compatibility, toggling activation status, and ensuring no system errors occur during these operations.",
    "code": "import requests\nimport time\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = (\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nHEADERS = {\n    \"Accept\": \"application/json\"\n}\nTIMEOUT = 30\n\n\ndef test_plugin_upload_toggle_and_manifest_validation():\n    session = requests.Session()\n    session.auth = AUTH\n    session.headers.update(HEADERS)\n\n    plugin_upload_url = f\"{BASE_URL}/admin/plugins/upload\"\n    plugin_toggle_url_template = f\"{BASE_URL}/admin/plugins/{{plugin_id}}/toggle\"\n    plugin_manifest_url_template = f\"{BASE_URL}/admin/plugins/{{plugin_id}}/manifest\"\n    plugin_delete_url_template = f\"{BASE_URL}/admin/plugins/{{plugin_id}}/delete\"\n\n    profile_url = f\"{BASE_URL}/profile\"\n    admin_url = f\"{BASE_URL}/admin\"\n    help_url = f\"{BASE_URL}/help\"\n\n    # Prepare a sample plugin file content (as bytes).\n    # This is a minimal plugin zip archive or file to simulate upload.\n    # Since file content is not specified, use dummy content with proper filename.\n    # Assume 'test_plugin.zip' is a valid plugin file for testing.\n    from io import BytesIO\n    plugin_file_content = BytesIO(b'PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00')  # dummy zip header bytes\n\n    # For checking system error strings anywhere in responses.\n    error_signatures = [\"PHP Warning\", \"missing table\", \"error\", \"Exception\"]\n\n    def check_no_system_errors(text):\n        lowered = text.lower()\n        for sig in error_signatures:\n            if sig.lower() in lowered:\n                return False\n        return True\n\n    plugin_id = None\n\n    try:\n        # 1. Confirm navigation to /profile, /admin, and /help works without errors\n        for url in [profile_url, admin_url, help_url]:\n            resp = session.get(url, timeout=TIMEOUT)\n            assert resp.status_code == 200, f\"Navigation to {url} failed with status {resp.status_code}\"\n            assert check_no_system_errors(resp.text), f\"System error detected on {url}\"\n\n        # 2. Upload a new plugin\n        files = {\n            'plugin_file': ('test_plugin.zip', plugin_file_content, 'application/zip')\n        }\n        resp = session.post(plugin_upload_url, files=files, timeout=TIMEOUT)\n        assert resp.status_code == 200, f\"Plugin upload failed with status {resp.status_code}\"\n        json_resp = resp.json()\n        assert \"plugin_id\" in json_resp, \"Response missing plugin_id after upload\"\n        plugin_id = json_resp[\"plugin_id\"]\n\n        # 3. Validate plugin manifest for compatibility\n        manifest_url = plugin_manifest_url_template.format(plugin_id=plugin_id)\n        resp = session.get(manifest_url, timeout=TIMEOUT)\n        assert resp.status_code == 200, f\"Plugin manifest request failed with status {resp.status_code}\"\n        manifest = resp.json()\n        # Check required manifest keys for compatibility (assuming fields)\n        required_keys = [\"name\", \"version\", \"compatible_versions\", \"author\"]\n        for key in required_keys:\n            assert key in manifest, f\"Manifest missing required key: {key}\"\n        # Assuming current system version is in manifest['compatible_versions'] list\n        system_version = \"2025.11.04\"\n        compatible = any(system_version in v or v in system_version for v in manifest.get(\"compatible_versions\", []))\n        assert compatible, \"Plugin manifest not compatible with system version\"\n\n        # 4. Toggle plugin activation status twice (activate then deactivate)\n        toggle_url = plugin_toggle_url_template.format(plugin_id=plugin_id)\n        for _ in range(2):  # toggle twice\n            resp = session.post(toggle_url, timeout=TIMEOUT)\n            assert resp.status_code == 200, f\"Plugin toggle failed with status {resp.status_code}\"\n            toggle_resp = resp.json()\n            assert \"active\" in toggle_resp, \"Toggle response missing 'active' field\"\n            assert isinstance(toggle_resp[\"active\"], bool), \"'active' field should be boolean\"\n            # Also verify no system errors in response content\n            assert check_no_system_errors(resp.text), \"System error detected during toggle\"\n\n        # 5. Check again no PHP warnings or missing table errors on /profile, /admin, /help pages after plugin operations\n        for url in [profile_url, admin_url, help_url]:\n            resp = session.get(url, timeout=TIMEOUT)\n            assert resp.status_code == 200, f\"Post-plugin navigation to {url} failed with status {resp.status_code}\"\n            assert check_no_system_errors(resp.text), f\"System error detected on {url} after plugin operations\"\n\n    finally:\n        # Cleanup plugin by deleting it\n        if plugin_id is not None:\n            delete_url = plugin_delete_url_template.format(plugin_id=plugin_id)\n            try:\n                resp = session.post(delete_url, timeout=TIMEOUT)\n                assert resp.status_code == 200, f\"Plugin deletion failed with status {resp.status_code}\"\n            except Exception:\n                # Fail silently on cleanup to not override test exceptions\n                pass\n\n\ntest_plugin_upload_toggle_and_manifest_validation()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 105, in <module>\n  File \"<string>\", line 50, in test_plugin_upload_toggle_and_manifest_validation\nAssertionError: System error detected on http://localhost:80/bishwo_calculator/profile\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.194Z",
    "modified": "2025-11-14T07:39:28.343Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "a828bbd4-df8d-41c7-b39b-819338ace829",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC004-backup_and_restore_system_state_verification",
    "description": "Test the backup and restore functionality by creating backups that include database dumps and theme/plugin data, restoring from backups, and verifying the system returns to the exact previous state.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = HTTPBasicAuth('uniquebishwo@gmail.com', 'c9PU7XAsAADYk_A')\nTIMEOUT = 30\n\ndef test_backup_and_restore_system_state_verification():\n    session = requests.Session()\n    session.auth = AUTH\n    session.headers.update({'Accept': 'application/json'})\n    backup_id = None\n    \n    def check_page_no_errors(path):\n        # Check page loads without PHP warnings or missing table errors\n        resp = session.get(f\"{BASE_URL}{path}\", timeout=TIMEOUT)\n        assert resp.status_code == 200, f\"Failed to load {path}\"\n        content = resp.text.lower()\n        assert 'warning' not in content, f\"PHP warnings found in {path}\"\n        assert 'error' not in content, f\"Errors found in {path}\"\n        assert 'missing table' not in content, f\"Missing table error in {path}\"\n\n    try:\n        # Step 1: Navigate profile, admin dashboard, help center to verify navigation works and no errors\n        for path in [\"/profile\", \"/admin\", \"/help\"]:\n            check_page_no_errors(path)\n\n        # Step 2: Create a backup (POST to /admin/help/backup)\n        backup_create_resp = session.post(f\"{BASE_URL}/admin/help/backup\", timeout=TIMEOUT)\n        assert backup_create_resp.status_code == 201 or backup_create_resp.status_code == 200,\\\n            f\"Backup creation failed with status {backup_create_resp.status_code}\"\n        backup_data = backup_create_resp.json()\n        assert 'backup_id' in backup_data, \"Backup ID missing in response\"\n        backup_id = backup_data['backup_id']\n\n        # Step 3: Verify that backup includes expected items by downloading artifact (assumed endpoint)\n        backup_download_resp = session.get(f\"{BASE_URL}/admin/help/backup/{backup_id}/download\", timeout=TIMEOUT)\n        assert backup_download_resp.status_code == 200, \"Failed to download backup file\"\n        content_disposition = backup_download_resp.headers.get('Content-Disposition', '')\n        assert 'attachment' in content_disposition.lower(), \"Backup download missing attachment disposition\"\n        # Basic content checks (we expect some binary data, so we just check size)\n        assert len(backup_download_resp.content) > 1000, \"Backup file size too small, likely incomplete\"\n\n        # Step 4: Restore from backup (POST to /admin/help/restore with backup_id)\n        restore_resp = session.post(f\"{BASE_URL}/admin/help/restore\", json={\"backup_id\": backup_id}, timeout=TIMEOUT)\n        assert restore_resp.status_code == 200, f\"Restore failed with status {restore_resp.status_code}\"\n        restore_result = restore_resp.json()\n        assert restore_result.get('success') is True, \"Restore response did not indicate success\"\n\n        # Step 5: After restore, re-check profile, admin, and help pages to confirm state restored and error free\n        for path in [\"/profile\", \"/admin\", \"/help\"]:\n            check_page_no_errors(path)\n\n    finally:\n        # Clean-up: if backup created, attempt to delete it (DELETE /admin/help/backup/{backup_id})\n        if backup_id:\n            try:\n                del_resp = session.delete(f\"{BASE_URL}/admin/help/backup/{backup_id}\", timeout=TIMEOUT)\n                # Deletion may return 200 or 204\n                assert del_resp.status_code in (200, 204), \"Failed to delete backup in cleanup\"\n            except Exception:\n                pass\n\ntest_backup_and_restore_system_state_verification()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 64, in <module>\n  File \"<string>\", line 26, in test_backup_and_restore_system_state_verification\n  File \"<string>\", line 19, in check_page_no_errors\nAssertionError: PHP warnings found in /profile\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.199Z",
    "modified": "2025-11-14T07:39:28.341Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "c98f7d1a-cfd0-4a0d-a329-c756ea16dc88",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC005-audit_log_filtering_and_download_functionality",
    "description": "Test the audit log viewer by applying various filters to the logs, downloading selected log files, and verifying the integrity and correctness of the downloaded data.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nHEADERS = {\n    \"Accept\": \"application/json\",\n}\nTIMEOUT = 30\n\ndef test_audit_log_filtering_and_download_functionality():\n    session = requests.Session()\n    session.auth = AUTH\n    session.headers.update(HEADERS)\n\n    try:\n        # Step 1: Access the audit log viewer page (/admin/audit-logs) to check for PHP warnings/missing tables\n        audit_logs_url = f\"{BASE_URL}/admin/audit-logs\"\n        resp = session.get(audit_logs_url, timeout=TIMEOUT)\n        assert resp.status_code == 200, f\"Expected 200 OK for audit log page, got {resp.status_code}\"\n        content_text = resp.text.lower()\n        assert \"warning\" not in content_text, \"PHP warning found in audit logs page HTML\"\n        assert \"missing table\" not in content_text, \"Missing table error found in audit logs page HTML\"\n\n        # Step 2: Apply various filters to audit logs\n        # Since no exact schema for filters provided, try common filters as query params:\n        # Example filters: date_from, date_to, user, action\n        filters = {\n            \"date_from\": \"2025-01-01\",\n            \"date_to\": \"2025-12-31\",\n            \"user\": \"admin\",\n            \"action\": \"login\",\n            \"format\": \"json\"  # Assume JSON response on filter with format=json\n        }\n        filtered_logs_resp = session.get(audit_logs_url, params=filters, timeout=TIMEOUT)\n        assert filtered_logs_resp.status_code == 200, f\"Filtering audit logs failed: {filtered_logs_resp.status_code}\"\n        filtered_data = filtered_logs_resp.json()\n        assert isinstance(filtered_data, dict) or isinstance(filtered_data, list), \"Filtered logs response not JSON format\"\n\n        # Basic validation: filtered logs should have entries or at least be valid JSON structure\n        assert filtered_data, \"Filtered audit logs are empty\"\n\n        # Step 3: Download selected audit log files\n        # Since no direct info on download links, simulate download by invoking a known endpoint:\n        # Assuming a parameter ?download=true or /download endpoint exists for audit logs\n        # Let's try /admin/audit-logs/download?date_from=...&date_to=...\n        download_url = f\"{BASE_URL}/admin/audit-logs/download\"\n        download_params = {\n            \"date_from\": filters[\"date_from\"],\n            \"date_to\": filters[\"date_to\"],\n            \"user\": filters[\"user\"],\n            \"action\": filters[\"action\"]\n        }\n        download_resp = session.get(download_url, params=download_params, timeout=TIMEOUT)\n        assert download_resp.status_code == 200, f\"Audit log download failed with status: {download_resp.status_code}\"\n\n        content_type = download_resp.headers.get(\"Content-Type\", \"\").lower()\n        assert \"application\" in content_type or \"octet-stream\" in content_type or \"zip\" in content_type, \\\n            f\"Unexpected Content-Type for download: {content_type}\"\n\n        content_disposition = download_resp.headers.get(\"Content-Disposition\", \"\").lower()\n        assert \"attachment\" in content_disposition or \"filename\" in content_disposition, \"No attachment disposition header\"\n\n        # Step 4: Verify integrity and correctness of downloaded data\n        # Check that content is not empty and appears to be a valid log or archive\n        content_bytes = download_resp.content\n        assert len(content_bytes) > 0, \"Downloaded audit log file is empty\"\n\n        # Additional minimal integrity check - for text logs check for expected text headers/log signature, for zip check header bytes\n        if \"zip\" in content_type or download_resp.content[:2] == b'PK':\n            # Zip archive detected - minimal check by ZIP signature \"PK\"\n            assert content_bytes.startswith(b'PK'), \"Downloaded file does not start with PK signature (zip)\"\n        else:\n            # Assume text log - check UTF-8 decode and presence of log keywords\n            text = content_bytes.decode('utf-8', errors='ignore').lower()\n            assert \"audit\" in text or \"log\" in text or \"event\" in text, \"Downloaded log content does not contain expected keywords\"\n\n        # Step 5: Additional navigation checks to profile (/profile), admin dashboard (/admin), and help center (/help)\n        for path in [\"/profile\", \"/admin\", \"/help\"]:\n            nav_resp = session.get(f\"{BASE_URL}{path}\", timeout=TIMEOUT)\n            assert nav_resp.status_code == 200, f\"Navigation failed for {path} with status {nav_resp.status_code}\"\n            nav_content = nav_resp.text.lower()\n            assert \"warning\" not in nav_content, f\"PHP warning found on page {path}\"\n            assert \"missing table\" not in nav_content, f\"Missing table error found on page {path}\"\n\n    finally:\n        session.close()\n\ntest_audit_log_filtering_and_download_functionality()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 89, in <module>\n  File \"<string>\", line 22, in test_audit_log_filtering_and_download_functionality\nAssertionError: PHP warning found in audit logs page HTML\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.204Z",
    "modified": "2025-11-14T07:39:26.499Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "021694da-0959-4fd9-9265-33f70eb6f40b",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC006-admin_post_routes_rate_limiting_and_csrf_protection",
    "description": "Test that all administrative POST routes enforce rate limiting and require valid CSRF tokens to prevent unauthorized or excessive requests.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nAUTH = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nTIMEOUT = 30\n\ndef get_csrf_token(session, url):\n    # Get the CSRF token by visiting the page and parsing the token from cookies or page (assuming cookie named csrf_token)\n    try:\n        resp = session.get(url, auth=AUTH, timeout=TIMEOUT)\n        resp.raise_for_status()\n        # Try to get CSRF token from cookies (common approach)\n        token = resp.cookies.get('csrf_token')\n        if not token:\n            # fallback: look for meta tag or hidden input - not possible here, so None\n            token = None\n        return token\n    except requests.RequestException:\n        return None\n\ndef test_admin_post_routes_rate_limiting_and_csrf_protection():\n    session = requests.Session()\n    session.auth = AUTH\n\n    post_endpoints = [\n        \"/admin/themes\",\n        \"/admin/help\",\n        \"/admin/plugins\"\n    ]\n\n    # We'll test POST to these URLs: base + endpoint.\n    # Since we don't know exact POST route detail, send minimal valid data for testing.\n    # For CSRF token, get from GET request cookie or assume it's required in header 'X-CSRF-Token'.\n    # Test sequence:\n    # 1. POST without CSRF token -> expect 403 or error about CSRF\n    # 2. POST with invalid CSRF token -> expect 403 or error\n    # 3. POST with valid CSRF token -> expect success or rate limiting\n    # 4. Rapid POSTs to check rate limiting (send multiple valid requests quickly)\n    \n    for endpoint in post_endpoints:\n        url = f\"{BASE_URL}{endpoint}\"\n        csrf_token = get_csrf_token(session, url)\n        headers = {}\n        if csrf_token:\n            headers['X-CSRF-Token'] = csrf_token\n\n        # 1. POST without CSRF token\n        try:\n            resp = session.post(url, headers={}, timeout=TIMEOUT, data={})\n            # Expect 403 Forbidden or 400 Bad Request indicating missing CSRF token\n            # Accept any client error status that indicate rejection due to missing CSRF\n            assert resp.status_code in (400, 403), f\"POST {endpoint} without CSRF should be rejected, got {resp.status_code}\"\n            # Check body or text to not contain php warnings or table errors\n            assert \"Warning\" not in resp.text, f\"PHP warning found in response body of POST {endpoint} without CSRF\"\n            assert \"Table\" not in resp.text or \"not found\" not in resp.text.lower(), f\"DB table error found in POST {endpoint} response\"\n        except requests.RequestException as e:\n            assert False, f\"RequestException on POST {endpoint} without CSRF: {e}\"\n\n        # 2. POST with invalid CSRF token\n        try:\n            invalid_headers = {'X-CSRF-Token': 'invalid_token'}\n            resp = session.post(url, headers=invalid_headers, timeout=TIMEOUT, data={})\n            assert resp.status_code in (400, 403), f\"POST {endpoint} with invalid CSRF token should be rejected, got {resp.status_code}\"\n            assert \"Warning\" not in resp.text, f\"PHP warning found in response body of POST {endpoint} with invalid CSRF\"\n            assert \"Table\" not in resp.text or \"not found\" not in resp.text.lower(), f\"DB table error found in POST {endpoint} response\"\n        except requests.RequestException as e:\n            assert False, f\"RequestException on POST {endpoint} with invalid CSRF: {e}\"\n\n        # 3. POST with valid CSRF token - attempt once and check success or rate limit\n        try:\n            resp = session.post(url, headers=headers, timeout=TIMEOUT, data={})\n            # Accept 200 OK, 201 Created, or 429 Too Many Requests (rate limiting)\n            assert resp.status_code in (200, 201, 429), f\"POST {endpoint} with valid CSRF should succeed or be rate-limited, got {resp.status_code}\"\n            assert \"Warning\" not in resp.text, f\"PHP warning found in response body of POST {endpoint} with valid CSRF\"\n            assert \"Table\" not in resp.text or \"not found\" not in resp.text.lower(), f\"DB table error found in POST {endpoint} response\"\n        except requests.RequestException as e:\n            assert False, f\"RequestException on POST {endpoint} with valid CSRF: {e}\"\n\n        # 4. Rate limiting - send multiple POSTs quickly with valid CSRF token and check if rate limiting kicks in\n        try:\n            rate_limit_triggered = False\n            for _ in range(5):  # Send 5 quick requests\n                resp = session.post(url, headers=headers, timeout=TIMEOUT, data={})\n                if resp.status_code == 429:\n                    rate_limit_triggered = True\n                    break\n            assert rate_limit_triggered, f\"Rate limiting not enforced on POST {endpoint} after rapid requests\"\n            assert \"Warning\" not in resp.text, f\"PHP warning found in response body during rate limit test POST {endpoint}\"\n            assert \"Table\" not in resp.text or \"not found\" not in resp.text.lower(), f\"DB table error found in rate limit POST {endpoint} response\"\n        except requests.RequestException as e:\n            assert False, f\"RequestException during rate limiting test POST {endpoint}: {e}\"\n\n    session.close()\n\ntest_admin_post_routes_rate_limiting_and_csrf_protection()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 96, in <module>\n  File \"<string>\", line 53, in test_admin_post_routes_rate_limiting_and_csrf_protection\nAssertionError: POST /admin/themes without CSRF should be rejected, got 404\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.210Z",
    "modified": "2025-11-14T07:40:30.744Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "14a7c990-72b1-4a2d-a498-5ca0866820be",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC007-structured_logging_for_general_and_audit_events",
    "description": "Verify that system logs and audit logs are structured correctly, include necessary event details, and are stored appropriately for audit and debugging purposes.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:80/bishwo_calculator\"\nTIMEOUT = 30\nAUTH = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\nHEADERS = {\n    \"Accept\": \"text/html,application/json\",\n    \"User-Agent\": \"BishwoTestAgent/1.0\"\n}\n\ndef test_structured_logging_for_general_and_audit_events():\n    \"\"\"\n    Verify that system logs and audit logs are structured correctly,\n    include necessary event details, and are stored appropriately for audit and debugging.\n    Focus on /profile, /admin, and /help; ensure no PHP warnings or missing table errors,\n    and navigation works without error.\n    \"\"\"\n    error_indicators = [\n        \"PHP Warning\",\n        \"Warning:\",\n        \"Missing table\",\n        \"Fatal error\",\n        \"Exception\",\n        \"Traceback\"\n    ]\n\n    # Endpoints to check\n    endpoints = [\"/profile\", \"/admin\", \"/help\"]\n\n    for endpoint in endpoints:\n        url = BASE_URL + endpoint\n        try:\n            resp = requests.get(url, auth=AUTH, headers=HEADERS, timeout=TIMEOUT)\n        except requests.RequestException as e:\n            assert False, f\"Request to {endpoint} failed with exception: {e}\"\n\n        # Status code check\n        assert resp.status_code == 200, f\"Expected 200 OK from {endpoint} but got {resp.status_code}\"\n\n        content = resp.text\n\n        # Ensure PHP warnings or missing table errors are not present in the response content\n        for err in error_indicators:\n            assert err not in content, f\"Error indicator '{err}' found in response from {endpoint}\"\n\n        # Check for structured log/event markers if present in the response (optional, based on UI exposure)\n        # For audit logs, request /admin/audit-logs and check JSON structure\n        if endpoint == \"/admin\":\n            audit_logs_url = BASE_URL + \"/admin/audit-logs\"\n            try:\n                audit_resp = requests.get(audit_logs_url, auth=AUTH, headers=HEADERS, timeout=TIMEOUT)\n            except requests.RequestException as e:\n                assert False, f\"Request to /admin/audit-logs failed with exception: {e}\"\n\n            assert audit_resp.status_code == 200, f\"/admin/audit-logs returned {audit_resp.status_code}, expected 200\"\n\n            # Only try parsing JSON if Content-Type is application/json\n            content_type = audit_resp.headers.get('Content-Type', '')\n            if 'application/json' in content_type:\n                try:\n                    audit_json = audit_resp.json()\n                except ValueError:\n                    assert False, \"/admin/audit-logs response is not valid JSON\"\n\n                # Validate audit log entries have structured necessary event details\n                assert isinstance(audit_json, dict), \"Audit logs response is not a JSON object\"\n                assert \"logs\" in audit_json, \"Audit logs JSON missing 'logs' key\"\n                logs = audit_json[\"logs\"]\n                assert isinstance(logs, list), \"'logs' key in audit logs response is not a list\"\n\n                for log_entry in logs:\n                    assert isinstance(log_entry, dict), \"Each log entry should be a dict\"\n                    # Check required keys for structured logs\n                    required_keys = [\"timestamp\", \"event_type\", \"user\", \"details\"]\n                    missing_keys = [k for k in required_keys if k not in log_entry]\n                    assert not missing_keys, f\"Audit log entry missing keys: {missing_keys}\"\n            else:\n                # If not JSON, just ensure no error indicators\n                for err in error_indicators:\n                    assert err not in audit_resp.text, f\"Error indicator '{err}' found in response from /admin/audit-logs\"\n\n    # Additional navigation check: from /profile to /admin, then /help\n    try:\n        session = requests.Session()\n        session.auth = AUTH\n        # Access /profile, then /admin, then /help sequentially\n        for path in [\"/profile\", \"/admin\", \"/help\"]:\n            resp = session.get(BASE_URL + path, headers=HEADERS, timeout=TIMEOUT)\n            assert resp.status_code == 200, f\"Navigation failed at {path} with status {resp.status_code}\"\n            # Ensure no error messages in any navigation step\n            for err in error_indicators:\n                assert err not in resp.text, f\"Error '{err}' found in navigation response at {path}\"\n    except requests.RequestException as e:\n        assert False, f\"Navigation requests failed with exception: {e}\"\n\n\ntest_structured_logging_for_general_and_audit_events()\n",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.215Z",
    "modified": "2025-11-14T07:39:56.252Z"
  },
  {
    "projectId": "da2bf492-9b02-4212-9da6-c9fffd47cef0",
    "testId": "8f139437-21e1-4ed9-b843-b06ec7a87e0b",
    "userId": "54080448-d011-70c6-fa1a-afc784d57ad1",
    "title": "TC008-api_health_endpoint_response_validation",
    "description": "Test the /api/v1/health endpoint to ensure it returns a 200 OK status with a valid JSON response indicating system availability.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\ndef test_api_health_endpoint_response_validation():\n    base_url = \"http://localhost:80/bishwo_calculator\"\n    endpoint = \"/api/v1/health\"\n    url = base_url + endpoint\n    auth = HTTPBasicAuth(\"uniquebishwo@gmail.com\", \"c9PU7XAsAADYk_A\")\n    headers = {\n        \"Accept\": \"application/json\"\n    }\n    try:\n        response = requests.get(url, headers=headers, auth=auth, timeout=30)\n    except requests.RequestException as e:\n        assert False, f\"HTTP request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n\n    try:\n        json_data = response.json()\n    except ValueError:\n        assert False, \"Response is not a valid JSON\"\n\n    # Validate typical health response keys likely indicating system availability\n    # Since schema detail not provided, verify keys like 'status' or 'healthy'\n    valid_keys = {'status', 'healthy', 'message', 'uptime'}\n    assert any(key in json_data for key in valid_keys), \\\n        f\"Response JSON does not contain expected health keys. Keys found: {list(json_data.keys())}\"\n\ntest_api_health_endpoint_response_validation()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-14T07:38:41.220Z",
    "modified": "2025-11-14T07:39:28.336Z"
  }
]
