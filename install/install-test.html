<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Installation Test & Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .info {
            color: #17a2b8;
        }
        
        .test-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        
        .test-pass {
            background: #d4edda;
            border: 1px solid #c3e6cb;
        }
        
        .test-fail {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        
        .test-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>

<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="text-center mb-5">
                    <h1 class="text-white">
                        <i class="fas fa-cogs"></i> Bishwo Calculator - Installation Test
                    </h1>
                    <p class="text-white-50">Comprehensive verification of installation components</p>
                </div>

                <!-- File System Test -->
                <div class="test-card p-4 mb-4">
                    <h3><i class="fas fa-folder-open"></i> File System Test</h3>
                    <div id="fileSystemTests"></div>
                </div>

                <!-- Installation Components Test -->
                <div class="test-card p-4 mb-4">
                    <h3><i class="fas fa-cog"></i> Installation Components</h3>
                    <div id="componentTests"></div>
                </div>

                <!-- Database Structure Test -->
                <div class="test-card p-4 mb-4">
                    <h3><i class="fas fa-database"></i> Database Structure</h3>
                    <div id="databaseTests"></div>
                </div>

                <!-- Email Test -->
                <div class="test-card p-4 mb-4">
                    <h3><i class="fas fa-envelope"></i> Email Configuration</h3>
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="testSmtpHost" placeholder="SMTP Host (e.g., smtp.gmail.com)" value="smtp.gmail.com">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="testSmtpPort" placeholder="Port" value="587">
                            </div>
                            <div class="col-md-3">
                                <input type="text" class="form-control" id="testSmtpUser" placeholder="Username" value="test@gmail.com">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <input type="password" class="form-control" id="testSmtpPass" placeholder="Password">
                            </div>
                            <div class="col-md-6">
                                <button class="btn btn-primary" onclick="testEmailConfig()">
                                    <i class="fas fa-paper-plane"></i> Test Email Configuration
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="emailTestResult"></div>
                </div>

                <!-- Installation Process Test -->
                <div class="test-card p-4 mb-4">
                    <h3><i class="fas fa-rocket"></i> Installation Process</h3>
                    <p class="text-muted">Test the complete installation process step by step</p>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                        <a href="index.php?step=welcome" class="btn btn-success">
                            <i class="fas fa-play"></i> Start Installation
                        </a>
                        <button class="btn btn-info" onclick="checkInstallationProgress()">
                            <i class="fas fa-chart-line"></i> Check Progress
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test file system components
        function testFileSystem() {
            const tests = [{
                name: 'Installer Class',
                file: 'includes/Installer.php',
                critical: true
            }, {
                name: 'Main Installation File',
                file: 'index.php',
                critical: true
            }, {
                name: 'Email Test Handler',
                file: 'ajax/test-email.php',
                critical: true
            }, {
                name: 'Installation CSS',
                file: 'assets/css/install.css',
                critical: true
            }, {
                name: 'Installation JS',
                file: 'assets/js/install.js',
                critical: true
            }, {
                name: 'Logo Image',
                file: 'assets/images/banner.jpg',
                critical: false
            }, {
                name: 'Test Script',
                file: 'test-installation.php',
                critical: false
            }];

            const container = document.getElementById('fileSystemTests');
            tests.forEach(test => {
                fetch(test.file, {
                        method: 'HEAD'
                    })
                    .then(response => {
                        const exists = response.ok;
                        const status = exists ? 'test-pass' : (test.critical ? 'test-fail' : 'test-warning');
                        const icon = exists ? 'fas fa-check-circle success' : (test.critical ? 'fas fa-times-circle error' : 'fas fa-exclamation-triangle warning');

                        container.innerHTML += `
                            <div class="test-item ${status}">
                                <i class="${icon}"></i> 
                                <strong>${test.name}:</strong> 
                                ${exists ? 'Available' : 'Missing'} 
                                ${test.critical ? '(Critical)' : '(Optional)'}
                            </div>
                        `;
                    })
                    .catch(() => {
                        const status = test.critical ? 'test-fail' : 'test-warning';
                        const icon = test.critical ? 'fas fa-times-circle error' : 'fas fa-exclamation-triangle warning';

                        container.innerHTML += `
                            <div class="test-item ${status}">
                                <i class="${icon}"></i> 
                                <strong>${test.name}:</strong> 
                                Error checking file
                            </div>
                        `;
                    });
            });
        }

        // Test email configuration
        function testEmailConfig() {
            const host = document.getElementById('testSmtpHost').value;
            const port = document.getElementById('testSmtpPort').value;
            const user = document.getElementById('testSmtpUser').value;
            const pass = document.getElementById('testSmtpPass').value;

            if (!host || !port || !user || !pass) {
                showEmailResult(false, 'All fields are required for testing.');
                return;
            }

            const resultDiv = document.getElementById('emailTestResult');
            resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> Testing email configuration...</div>';

            // Create form data
            const formData = new FormData();
            formData.append('smtp_host', host);
            formData.append('smtp_port', port);
            formData.append('smtp_user', user);
            formData.append('smtp_pass', pass);

            // Test email configuration
            fetch('ajax/test-email.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    showEmailResult(data.success, data.message);
                })
                .catch(error => {
                    showEmailResult(false, 'Network error: ' + error.message);
                });
        }

        function showEmailResult(success, message) {
            const resultDiv = document.getElementById('emailTestResult');
            const alertClass = success ? 'alert-success' : 'alert-danger';
            const icon = success ? 'fa-check-circle' : 'fa-exclamation-triangle';

            resultDiv.innerHTML = `
                <div class="alert ${alertClass}">
                    <i class="fas ${icon}"></i> ${message}
                </div>
            `;
        }

        // Test installation components
        function testComponents() {
            const container = document.getElementById('componentTests');

            // Test AJAX endpoint accessibility
            fetch('ajax/test-email.php', {
                    method: 'HEAD'
                })
                .then(response => {
                    const status = response.ok ? 'test-pass' : 'test-fail';
                    const icon = response.ok ? 'fas fa-check-circle success' : 'fas fa-times-circle error';
                    const text = response.ok ? 'Email test endpoint accessible' : 'Email test endpoint not accessible';

                    container.innerHTML = `
                        <div class="test-item ${status}">
                            <i class="${icon}"></i> <strong>AJAX Endpoint:</strong> ${text}
                        </div>
                    `;
                })
                .catch(() => {
                    container.innerHTML = `
                        <div class="test-item test-fail">
                            <i class="fas fa-times-circle error"></i> <strong>AJAX Endpoint:</strong> Network error
                        </div>
                    `;
                });
        }

        // Check database structure
        function testDatabase() {
            const container = document.getElementById('databaseTests');

            // This would typically test database connection
            // For now, we'll show a placeholder
            container.innerHTML = `
                <div class="test-item test-warning">
                    <i class="fas fa-info-circle info"></i> 
                    <strong>Database Test:</strong> Requires installation process to be initiated
                </div>
            `;
        }

        // Check installation progress
        function checkInstallationProgress() {
            // This would check session-based progress
            alert('Installation progress checking would be implemented here.');
        }

        // Initialize tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            testFileSystem();
            testComponents();
            testDatabase();
        });
    </script>
</body>

</html>