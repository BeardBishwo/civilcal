<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Marketing Agreement Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .checkbox-item { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 15px; }
        .checkbox-item input[type="checkbox"] { width: auto; margin: 0; }
        .checkbox-text { font-size: 14px; line-height: 1.4; }
        .checkbox-text a { color: #4f46e5; text-decoration: none; }
        .checkbox-text a:hover { text-decoration: underline; }
        button { background: #4f46e5; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; }
        button:hover { background: #3730a3; }
        button:disabled { background: #9ca3af; cursor: not-allowed; }
        .result { margin-top: 20px; padding: 15px; border-radius: 8px; }
        .success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .error { background: #fee2e2; color: #dc2626; border: 1px solid #ef4444; }
        .info-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .required { color: #ef4444; }
    </style>
</head>
<body>
    <h2>üìß Registration Marketing Agreement Test</h2>
    
    <div class="info-box">
        <h3>üß™ Test Purpose:</h3>
        <p>This test verifies that marketing agreement preferences are properly saved during registration.</p>
        <ul>
            <li><strong>‚úÖ Terms Agreement:</strong> Required for registration</li>
            <li><strong>üìß Marketing Emails:</strong> Optional - saved for future promotional use</li>
        </ul>
    </div>
    
    <form id="testForm">
        <div class="form-group">
            <label for="username">Username <span class="required">*</span></label>
            <input type="text" id="username" name="username" placeholder="testuser123" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email <span class="required">*</span></label>
            <input type="email" id="email" name="email" placeholder="test@example.com" required>
        </div>
        
        <div class="form-group">
            <label for="password">Password <span class="required">*</span></label>
            <input type="password" id="password" name="password" placeholder="password123" required>
        </div>
        
        <div class="form-group">
            <label for="full_name">Full Name <span class="required">*</span></label>
            <input type="text" id="full_name" name="full_name" placeholder="Test User" required>
        </div>
        
        <div class="form-group">
            <label for="engineer_roles">Engineering Specialty <span class="required">*</span></label>
            <select id="engineer_roles" name="engineer_roles" required>
                <option value="">Select specialty</option>
                <option value="civil">Civil Engineering</option>
                <option value="electrical">Electrical Engineering</option>
                <option value="mechanical">Mechanical Engineering</option>
                <option value="structural">Structural Engineering</option>
            </select>
        </div>
        
        <!-- Agreement Section -->
        <div class="form-section agreement-wrapper">
            <div class="form-group">
                <label class="checkbox-item">
                    <input type="checkbox" id="terms_agree" name="terms_agree" required>
                    <span class="checkbox-text">
                        I agree to the <a href="#" target="_blank">Terms of Service</a> 
                        and <a href="#" target="_blank">Privacy Policy</a> <span class="required">*</span>
                    </span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="checkbox-item">
                    <input type="checkbox" id="marketing_agree" name="marketing_agree">
                    <span class="checkbox-text">
                        üìß I would like to receive engineering tips and product updates via email (optional)
                    </span>
                </label>
            </div>
        </div>
        
        <button type="submit">Test Registration</button>
    </form>
    
    <div id="result"></div>

    <script>
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const resultDiv = document.getElementById('result');
            
            // Collect form data
            const payload = {
                username: formData.get('username'),
                email: formData.get('email'),
                password: formData.get('password'),
                full_name: formData.get('full_name'),
                engineer_roles: [formData.get('engineer_roles')],
                terms_agree: document.getElementById('terms_agree').checked,
                marketing_agree: document.getElementById('marketing_agree').checked
            };
            
            resultDiv.innerHTML = '<p>üîÑ Testing registration with marketing preferences...</p>';
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>‚úÖ Registration Test Successful!</h3>
                        <p><strong>User:</strong> ${payload.username} (${payload.email})</p>
                        <p><strong>Terms Agreement:</strong> ${payload.terms_agree ? '‚úÖ Agreed' : '‚ùå Not Agreed'}</p>
                        <p><strong>Marketing Emails:</strong> ${payload.marketing_agree ? 'üìß Opted In' : 'üö´ Opted Out'}</p>
                        <p><strong>Engineering Specialty:</strong> ${payload.engineer_roles[0]}</p>
                        <p>üéâ Marketing preference has been saved to database!</p>
                        <p><small>Note: This was a test registration. You can check the marketing tools to see the saved preference.</small></p>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h3>‚ùå Registration Failed</h3>
                        <p><strong>Error:</strong> ${result.error}</p>
                        <p>Please check the form and try again.</p>
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Connection Error</h3>
                    <p>Unable to connect to server: ${error.message}</p>
                `;
            }
        });
        
        // Pre-fill form with test data
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('username').value = 'testuser' + Math.floor(Math.random() * 1000);
            document.getElementById('email').value = 'test' + Math.floor(Math.random() * 1000) + '@example.com';
            document.getElementById('password').value = 'password123';
            document.getElementById('full_name').value = 'Test User';
            document.getElementById('engineer_roles').value = 'civil';
            
            // Check marketing agreement by default for testing
            document.getElementById('marketing_agree').checked = true;
        });
    </script>
</body>
</html>
