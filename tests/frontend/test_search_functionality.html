<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Functionality Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f8fafc;
        }
        
        .test-section {
            background: white;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .search-results {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
        }
        
        .result-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .result-item:hover {
            background: #f8fafc;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .result-description {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .result-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            border: 1px solid;
        }
        
        .badge-category {
            background: rgba(79, 70, 229, 0.1);
            color: #4f46e5;
            border-color: rgba(79, 70, 229, 0.2);
        }
        
        .badge-subcategory {
            background: rgba(100, 116, 139, 0.1);
            color: #64748b;
            border-color: rgba(100, 116, 139, 0.2);
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .debug-info {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 15px;
            white-space: pre-wrap;
        }
        
        button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #3730a3;
        }
        
        .test-queries {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .test-query {
            background: #e5e7eb;
            color: #374151;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
        }
        
        .test-query:hover {
            background: #d1d5db;
        }
    </style>
</head>
<body>
    <h2>üîç Search Functionality Test</h2>
    <p>Test the calculator search functionality and debug any issues</p>
    
    <div class="test-section">
        <h3>üìù Search Test</h3>
        
        <div class="test-queries">
            <span class="test-query" onclick="testSearch('concrete')">concrete</span>
            <span class="test-query" onclick="testSearch('volume')">volume</span>
            <span class="test-query" onclick="testSearch('civil')">civil</span>
            <span class="test-query" onclick="testSearch('rebar')">rebar</span>
            <span class="test-query" onclick="testSearch('electrical')">electrical</span>
            <span class="test-query" onclick="testSearch('beam')">beam</span>
        </div>
        
        <input type="text" id="searchInput" class="search-input" 
               placeholder="Type to search calculators..." 
               oninput="performSearch(this.value)">
        
        <div id="searchStatus"></div>
        <div id="searchResults" class="search-results"></div>
        <div id="debugInfo" class="debug-info" style="display: none;"></div>
        
        <div style="margin-top: 15px;">
            <button onclick="toggleDebug()">Toggle Debug Info</button>
            <button onclick="testAPIDirectly()">Test API Directly</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
    </div>
    
    <div class="test-section">
        <h3>üîß API Information</h3>
        <div id="apiInfo">
            <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>Detected Base URL:</strong> <span id="detectedBaseUrl"></span></p>
            <p><strong>Search API URL:</strong> <span id="searchApiUrl"></span></p>
        </div>
    </div>

    <script>
        let debugMode = false;
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateAPIInfo();
            log('Search functionality test page loaded');
        });
        
        function updateAPIInfo() {
            const currentPath = window.location.pathname;
            let baseUrl = '';
            
            // Detect base URL (same logic as header)
            if (currentPath.includes('/Bishwo_Calculator/')) {
                baseUrl = '/Bishwo_Calculator';
            } else if (currentPath.includes('/bishwo_calculator/')) {
                baseUrl = '/bishwo_calculator';
            } else if (currentPath.includes('/aec-calculator/')) {
                baseUrl = '/aec-calculator';
            }
            
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('detectedBaseUrl').textContent = baseUrl || '(root)';
            document.getElementById('searchApiUrl').textContent = `${baseUrl}/api/search.php`;
        }
        
        function performSearch(query) {
            if (!query || query.length < 2) {
                document.getElementById('searchResults').innerHTML = '';
                document.getElementById('searchStatus').innerHTML = '';
                return;
            }
            
            log(`Searching for: "${query}"`);
            
            const currentPath = window.location.pathname;
            let baseUrl = '';
            
            if (currentPath.includes('/Bishwo_Calculator/')) {
                baseUrl = '/Bishwo_Calculator';
            } else if (currentPath.includes('/bishwo_calculator/')) {
                baseUrl = '/bishwo_calculator';
            } else if (currentPath.includes('/aec-calculator/')) {
                baseUrl = '/aec-calculator';
            }
            
            const searchUrl = `${baseUrl}/api/search.php?q=${encodeURIComponent(query)}`;
            log(`Search URL: ${searchUrl}`);
            
            showStatus('Searching...', 'info');
            
            fetch(searchUrl)
                .then(response => {
                    log(`Response status: ${response.status}`);
                    log(`Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return response.json();
                })
                .then(data => {
                    log(`Search results: ${JSON.stringify(data, null, 2)}`);
                    displayResults(data);
                    
                    if (Array.isArray(data) && data.length > 0) {
                        showStatus(`Found ${data.length} results`, 'success');
                    } else {
                        showStatus('No results found', 'info');
                    }
                })
                .catch(error => {
                    log(`Search error: ${error.message}`);
                    console.error('Search error:', error);
                    
                    showStatus(`Search failed: ${error.message}`, 'error');
                    document.getElementById('searchResults').innerHTML = `
                        <div style="text-align:center;padding:2rem;color:#ef4444;">
                            <i class="fas fa-exclamation-triangle" style="margin-right:0.5rem;"></i>
                            Search failed: ${error.message}
                        </div>
                    `;
                });
        }
        
        function displayResults(data) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (!Array.isArray(data) || data.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="text-align:center;padding:2rem;color:#64748b;">
                        <i class="fas fa-search" style="margin-right:0.5rem;"></i>
                        No calculators found
                    </div>
                `;
                return;
            }
            
            resultsContainer.innerHTML = data.map(item => `
                <div class="result-item" onclick="openCalculator('${item.url}')">
                    <div class="result-title">
                        <i class="${item.icon || 'fas fa-calculator'}" style="margin-right:8px;color:${item.color || '#6c757d'};"></i>
                        ${item.name}
                    </div>
                    <div class="result-description">${item.description || ''}</div>
                    <div class="result-badges">
                        ${item.category ? `<span class="badge badge-category">${item.category}</span>` : ''}
                        ${item.subcategory ? `<span class="badge badge-subcategory">${item.subcategory}</span>` : ''}
                        ${item.type === 'history' ? `<span class="badge" style="background:rgba(5,150,105,0.1);color:#059669;border-color:rgba(5,150,105,0.2);">Recent</span>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function testSearch(query) {
            document.getElementById('searchInput').value = query;
            performSearch(query);
        }
        
        function testAPIDirectly() {
            const currentPath = window.location.pathname;
            let baseUrl = '';
            
            if (currentPath.includes('/Bishwo_Calculator/')) {
                baseUrl = '/Bishwo_Calculator';
            } else if (currentPath.includes('/bishwo_calculator/')) {
                baseUrl = '/bishwo_calculator';
            } else if (currentPath.includes('/aec-calculator/')) {
                baseUrl = '/aec-calculator';
            }
            
            const testUrl = `${baseUrl}/api/search.php?q=concrete`;
            window.open(testUrl, '_blank');
        }
        
        function openCalculator(url) {
            log(`Opening calculator: ${url}`);
            window.open(url, '_blank');
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('searchStatus');
            statusDiv.innerHTML = `<div class="status status-${type}"><i class="fas fa-info-circle"></i> ${message}</div>`;
        }
        
        function clearResults() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('searchStatus').innerHTML = '';
            log('Results cleared');
        }
        
        function toggleDebug() {
            debugMode = !debugMode;
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.style.display = debugMode ? 'block' : 'none';
        }
        
        function log(message) {
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(logMessage);
            
            if (debugMode) {
                const debugDiv = document.getElementById('debugInfo');
                debugDiv.textContent += logMessage + '\n';
                debugDiv.scrollTop = debugDiv.scrollHeight;
            }
        }
    </script>
</body>
</html>
