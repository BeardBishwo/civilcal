<?php
// Minimal Router subdirectory test without dependencies
$_SERVER['REQUEST_URI'] = '/bishwo_calculator/public/';
$_SERVER['SCRIPT_NAME'] = '/bishwo_calculator/public/index.php';
$_SERVER['REQUEST_METHOD'] = 'GET';

echo "=== MINIMAL SUBDIRECTORY ROUTER TEST ===\n\n";

// Simulate a simple Router class with just our subdirectory fix
class TestRouter {
    public $routes = [
        ['method' => 'GET', 'uri' => '/', 'controller' => 'HomeController@index']
    ];
    
    public function getBasePath() {
        $scriptName = $_SERVER['SCRIPT_NAME'];
        $scriptDir = dirname($scriptName);
        if ($scriptDir !== '/') {
            return rtrim($scriptDir, '/');
        }
        return null;
    }
    
    public function dispatch() {
        $uri = parse_url($_SERVER['REQUEST_URI'], PHP_URL_PATH);
        $method = $_SERVER['REQUEST_METHOD'];
        
        echo "Original URI: $uri\n";
        
        // Apply our subdirectory fix
        $basePath = $this->getBasePath();
        echo "Base Path Detected: " . ($basePath ? $basePath : "None") . "\n";
        
        if ($basePath && strpos($uri, $basePath) === 0) {
            $uri = substr($uri, strlen($basePath));
            if (empty($uri)) {
                $uri = '/';
            }
        }
        
        echo "Processed URI: $uri\n";
        echo "HTTP Method: $method\n\n";
        
        // Test route matching
        foreach ($this->routes as $route) {
            if ($route['method'] === $method && $route['uri'] === $uri) {
                echo "âœ… ROUTE MATCHED: {$route['method']} {$route['uri']}\n";
                echo "âœ… Controller: {$route['controller']}\n";
                echo "\nðŸŽ‰ SUCCESS! Subdirectory routing works perfectly!\n";
                return;
            }
        }
        
        echo "âŒ No route found for: $method $uri\n";
    }
}

// Test the fix
$router = new TestRouter();
$router->dispatch();
?>
