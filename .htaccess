# Security: Block access to sensitive directories and files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Block access to sensitive directories
RedirectMatch 403 ^/(app|config|database|includes|storage|vendor|tests)/.*$

# Block access to sensitive files
<FilesMatch "(^#.*#|\.(bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Block composer files
<FilesMatch "^(composer\.(json|lock)|\.env.*|\.git.*)$">
    Order allow,deny
    Deny from all
</FilesMatch>

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block direct access to index.php in root (force .htaccess routing)
    RewriteCond %{THE_REQUEST} ^[A-Z]+\ /[^/]*index\.php
    RewriteRule ^index\.php$ - [F,L]
    
    # Redirect any /public URL to clean URL (permanent redirect)
    RewriteCond %{REQUEST_URI} public
    RewriteRule ^(.*)public/?(.*)$ /$1$2 [R=301,L]
    
    # Serve static assets from public/assets
    RewriteRule ^assets/(.*)$ public/assets/$1 [L]
    
    # Route all other requests through public/index.php
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ public/index.php [L,QSA]
</IfModule>
